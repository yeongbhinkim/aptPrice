<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dbvalley.premier.qms.qualityindex.mapper.SubkdIndexMapper"> 
	<!-- Sub-KD 포장장 월 WORST 데이터 조회 -->
	<select id="selectSubkdWorstPackageData" parameterType="json" resultType="json">
		SELECT TO_CHAR(ROWNUM) TITLE1, PREMIER_SYS.GETCMPYNMBYCMPYSN(G_VENDCD) TITLE2, T.QTY, T.CNT 
		     , ROUND(RATIO_TO_REPORT(CNT) OVER() * 100) AS RATIO
		  FROM (
		SELECT G_VENDCD, NVL(SUM(BAL_QTY),0) QTY, COUNT(1) CNT
		  FROM Q_100 A 
		 WHERE A.COMPANYCD = #{COMPANYCD}
		   AND A.B_GBN ='0000002130'
		   AND B_YMD LIKE #{YYYYMM}||'%'
		 GROUP BY G_VENDCD) T
		 WHERE ROWNUM <![CDATA[<]]> 11
		UNION ALL
		SELECT 'TOTAL' TITLE1, '' TITLE2, NVL(SUM(BAL_QTY),0) QTY, COUNT(1) CNT , 100
		  FROM Q_100 A 
		 WHERE A.COMPANYCD = #{COMPANYCD}
		   AND A.B_GBN ='0000002130'
		   AND B_YMD LIKE #{YYYYMM}||'%' 
				
	</select>
	<!-- Sub-KD 월별 불량 WORST 데이터 조회 -->
	<select id="selectSubkdWorstData" parameterType="json" resultType="json">
		SELECT TO_CHAR(ROWNUM) TITLE1, R.TITLE2, NVL(R.CNT,0) CNT, NVL(R.QTY,0) QTY, NVL(R.AMT,0) AMT, NVL(R.WH_QTY,0) WH_QTY
		     , CASE WHEN R.QTY <![CDATA[>]]>  0 AND R.WH_QTY <![CDATA[>]]> 0 THEN NVL(ROUND(R.QTY / R.WH_QTY * 1000000),0) ELSE 0 END PPM 
		  FROM (
		SELECT T1.NM_KOR TITLE2, T1.CNT, T1.QTY, T1.AMT
		     , SUM(T2.MENGE) WH_QTY
		  FROM (
		    SELECT T.* FROM (
		        SELECT B.NM_KOR, B.EMP_NO
		             , COUNT(A.G_VENDCD) CNT
		             , SUM(A.BAL_QTY) QTY
		             , SUM(A.K_QTY) AMT
		          FROM Q_100 A, PREMIER_SYS.COM_USER_INFO B
		         WHERE A.G_VENDCD = B.CMPY_SN 
		           AND A.COMPANYCD = #{COMPANYCD}
		           AND A.B_YMD LIKE #{YYYYMM}||'%'
		           AND A.B_GBN IN ('0000002133','0000002130')
		         GROUP BY B.NM_KOR, B.EMP_NO
		         ORDER BY 4 DESC
		    )T 
		    WHERE ROWNUM <![CDATA[<]]> 6) T1
		, (SELECT LIFNR, MENGE FROM ERP_BASIC WHERE GUBUN = 'MM' AND SPMON = #{YYYYMM} AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT2 = 'Y')) T2
		WHERE T1.EMP_NO = T2.LIFNR(+)
		GROUP BY T1.NM_KOR, T1.EMP_NO, T1.CNT, T1.QTY, T1.AMT
		ORDER BY 3 DESC ) R
		UNION ALL
		SELECT 'TOTAL' TITLE1, '' TITLE2, NVL(R.CNT,0) CNT, NVL(R.QTY,0) QTY, NVL(R.AMT,0) AMT, NVL(R.WH_QTY,0) WH_QTY
		     , NVL(ROUND(R.QTY / R.WH_QTY * 1000000),0) PPM 
		  FROM (
		SELECT SUM(T1.CNT) CNT, SUM(T1.QTY) QTY, SUM(T1.AMT) AMT, WH_QTY 
		  FROM (SELECT B.NM_KOR, B.EMP_NO
		             , COUNT(A.G_VENDCD) CNT
		             , SUM(A.BAL_QTY) QTY
		             , SUM(A.K_QTY) AMT
		          FROM Q_100 A, COM_USER_INFO B
		         WHERE A.G_VENDCD = B.CMPY_SN 
		           AND A.COMPANYCD = #{COMPANYCD}
		           AND A.B_YMD LIKE #{YYYYMM}||'%'
		           AND A.B_GBN = '0000002133'
		           AND A.GUBUN <![CDATA[<>]]> '0000002209' 
		         GROUP BY B.NM_KOR, B.EMP_NO
		         ORDER BY 4 DESC
		    ) T1
		, (SELECT SUM(MENGE) WH_QTY FROM ERP_BASIC WHERE GUBUN = 'MM' AND SPMON = #{YYYYMM} AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT2 = 'Y')
		     AND LIFNR IN (SELECT B.EMP_NO
		          FROM Q_100 A, PREMIER_SYS.COM_USER_INFO B
		         WHERE A.G_VENDCD = B.CMPY_SN 
		           AND COMPANYCD = #{COMPANYCD}
		           AND A.B_YMD LIKE #{YYYYMM}||'%'
		           AND A.B_GBN = '0000002133'
		           AND A.GUBUN <![CDATA[<>]]> '0000002209'
		         GROUP BY B.EMP_NO)
		) T2
		GROUP BY WH_QTY) R
	</select>
	<!-- Sub-KD 해외본부별 PPM 조회 -->
	<select id="selectForeignHqPPM" parameterType="json" resultType="json">
		SELECT #{GUBUN} TITLE1, #{PLANT_NM} TITLE2
			 , CASE WHEN T1.PREV <![CDATA[>]]> 0 AND T2.PREV <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.PREV/T2.PREV*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END PREV
		     , CASE WHEN T1.YYYY <![CDATA[>]]> 0 AND T2.YYYY <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.YYYY/T2.YYYY*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END YYYY
		     , CASE WHEN T1.C01 <![CDATA[>]]> 0 AND T2.C01 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C01/T2.C01*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C01
		     , CASE WHEN T1.C02 <![CDATA[>]]> 0 AND T2.C02 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C02/T2.C02*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C02
		     , CASE WHEN T1.C03 <![CDATA[>]]> 0 AND T2.C03 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C03/T2.C03*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C03
		     , CASE WHEN T1.C04 <![CDATA[>]]> 0 AND T2.C04 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C04/T2.C04*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C04
		     , CASE WHEN T1.C05 <![CDATA[>]]> 0 AND T2.C05 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C05/T2.C05*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C05
		     , CASE WHEN T1.C06 <![CDATA[>]]> 0 AND T2.C06 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C06/T2.C06*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C06
		     , CASE WHEN T1.C07 <![CDATA[>]]> 0 AND T2.C07 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C07/T2.C07*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C07
		     , CASE WHEN T1.C08 <![CDATA[>]]> 0 AND T2.C08 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C08/T2.C08*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C08
		     , CASE WHEN T1.C09 <![CDATA[>]]> 0 AND T2.C09 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C09/T2.C09*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C09
		     , CASE WHEN T1.C10 <![CDATA[>]]> 0 AND T2.C10 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C10/T2.C10*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C10
		     , CASE WHEN T1.C11 <![CDATA[>]]> 0 AND T2.C11 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C11/T2.C11*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C11
		     , CASE WHEN T1.C12 <![CDATA[>]]> 0 AND T2.C12 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C12/T2.C12*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C12
		  FROM (
		SELECT NVL(SUM(CASE WHEN B_YMD LIKE #{PREV}||'%' THEN BAL_QTY ELSE 0 END),0) PREV
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END),0) YYYY
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END),0) C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END),0) C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END),0) C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END),0) C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END),0) C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END),0) C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END),0) C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END),0) C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END),0) C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END),0) C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END),0) C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END),0) C12
		  FROM Q_100 A, (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT2 = 'Y' 
						  <if test="MGT1 != null and MGT1 !=''">
						  	AND MGT1 = #{MGT1} 
						  </if>
		  				) B
		 WHERE A.COMPANYCD = #{COMPANYCD} AND A.PLANT = B.PLANT_CD AND A.B_GBN IN ('0000002133','0000002130') ) T1
		, (
		SELECT SUM(CASE WHEN SPMON LIKE #{PREV}||'%' THEN MENGE ELSE 0 END) PREV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) YYYY
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) C01
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) C02
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) C03
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) C04
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) C05
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) C06
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) C07
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) C08
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) C09
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) C10
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) C11
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) C12
		  FROM ERP_BASIC A, (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT2 = 'Y' 
		  					<if test="MGT1 != null and MGT1 !=''">
						  		AND MGT1 = #{MGT1} 
						  	</if>
		  					) B
		 WHERE A.PLANT = B.PLANT_CD AND A.GUBUN = 'MM') T2
	</select>
	<!-- Sub-KD 해외법인별 PPM 조회 -->
	<select id="selectForeignPlantPPM" parameterType="json" resultType="json">
		SELECT #{GUBUN} TITLE1, #{PLANT_NM} TITLE2
			 , CASE WHEN T1.PREV <![CDATA[>]]> 0 AND T2.PREV <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.PREV/T2.PREV*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END PREV
		     , CASE WHEN T1.YYYY <![CDATA[>]]> 0 AND T2.YYYY <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.YYYY/T2.YYYY*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END YYYY
		     , CASE WHEN T1.C01 <![CDATA[>]]> 0 AND T2.C01 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C01/T2.C01*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C01
		     , CASE WHEN T1.C02 <![CDATA[>]]> 0 AND T2.C02 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C02/T2.C02*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C02
		     , CASE WHEN T1.C03 <![CDATA[>]]> 0 AND T2.C03 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C03/T2.C03*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C03
		     , CASE WHEN T1.C04 <![CDATA[>]]> 0 AND T2.C04 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C04/T2.C04*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C04
		     , CASE WHEN T1.C05 <![CDATA[>]]> 0 AND T2.C05 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C05/T2.C05*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C05
		     , CASE WHEN T1.C06 <![CDATA[>]]> 0 AND T2.C06 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C06/T2.C06*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C06
		     , CASE WHEN T1.C07 <![CDATA[>]]> 0 AND T2.C07 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C07/T2.C07*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C07
		     , CASE WHEN T1.C08 <![CDATA[>]]> 0 AND T2.C08 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C08/T2.C08*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C08
		     , CASE WHEN T1.C09 <![CDATA[>]]> 0 AND T2.C09 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C09/T2.C09*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C09
		     , CASE WHEN T1.C10 <![CDATA[>]]> 0 AND T2.C10 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C10/T2.C10*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C10
		     , CASE WHEN T1.C11 <![CDATA[>]]> 0 AND T2.C11 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C11/T2.C11*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C11
		     , CASE WHEN T1.C12 <![CDATA[>]]> 0 AND T2.C12 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T1.C12/T2.C12*1000000,2),'FM999999999999990.99'),'.') ELSE '0' END C12
		  FROM (
		SELECT NVL(SUM(CASE WHEN B_YMD LIKE #{PREV}||'%' THEN BAL_QTY ELSE 0 END),0) PREV
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END),0) YYYY
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END),0) C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END),0) C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END),0) C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END),0) C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END),0) C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END),0) C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END),0) C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END),0) C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END),0) C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END),0) C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END),0) C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END),0) C12
		  FROM Q_100 A
		 WHERE A.COMPANYCD = #{COMPANYCD} AND A.PLANT = #{PLANT_CD} AND A.GUBUN <![CDATA[<>]]> '0000002209' AND A.B_GBN IN ('0000002133','0000002130') ) T1
		, (
		SELECT SUM(CASE WHEN SPMON LIKE #{PREV}||'%' THEN MENGE ELSE 0 END) PREV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) YYYY
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) C01
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) C02
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) C03
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) C04
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) C05
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) C06
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) C07
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) C08
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) C09
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) C10
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) C11
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) C12
		  FROM ERP_BASIC A
		 WHERE A.PLANT = #{PLANT_CD} AND A.GUBUN = 'MM') T2
	</select>
	<!-- Sub-KD 해외법인 조회 -->
	<select id="selectForeignPlantList" parameterType="string" resultType="json">
		SELECT PLANT_CD, PLANT_NM FROM COM_PLANT_INFO WHERE MGT1 = #{MGT1} AND MGT2 = 'Y'
	</select>
	<!-- Sub-KD 년도별 추이 데이터 조회  -->
	<select id="selectSubkdYearData" parameterType="json" resultType="json">
		SELECT CASE WHEN YY = #{PREV_9} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_9
		     , CASE WHEN YY = #{PREV_8} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_8
		     , CASE WHEN YY = #{PREV_7} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_7
		     , CASE WHEN YY = #{PREV_6} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_6
		     , CASE WHEN YY = #{PREV_5} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_5
		     , CASE WHEN YY = #{PREV_4} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_4
		     , CASE WHEN YY = #{PREV_3} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_3
		     , CASE WHEN YY = #{PREV_2} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_2
		     , CASE WHEN YY = #{PREV_1} THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END PREV_1
		     , CASE WHEN YY = #{YYYY}   THEN RTRIM(TO_CHAR(ROUND(NVL((G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12,0),2),'FM999999999999990.99'),'.') ELSE '' END YYYY
		     , 'PPM' TITLE1
		     , PREMIER_SYS.GETMESSAGE('label.goal',#{LANG}) TITLE2
		     , '0' "id"
		  FROM Q_050 
		 WHERE B_GBN = '0000003579' 
		   AND PLANTCD = '1100'
		UNION ALL
		SELECT CASE WHEN T2.PREV_9 <![CDATA[>]]> 0 AND T1.PREV_9 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_9/T1.PREV_9*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_9 
		     , CASE WHEN T2.PREV_8 <![CDATA[>]]> 0 AND T1.PREV_8 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_8/T1.PREV_8*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_8
		     , CASE WHEN T2.PREV_7 <![CDATA[>]]> 0 AND T1.PREV_7 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_7/T1.PREV_7*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_7
		     , CASE WHEN T2.PREV_6 <![CDATA[>]]> 0 AND T1.PREV_6 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_6/T1.PREV_6*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_6
		     , CASE WHEN T2.PREV_5 <![CDATA[>]]> 0 AND T1.PREV_5 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_5/T1.PREV_5*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_5
		     , CASE WHEN T2.PREV_4 <![CDATA[>]]> 0 AND T1.PREV_4 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_4/T1.PREV_4*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_4
		     , CASE WHEN T2.PREV_3 <![CDATA[>]]> 0 AND T1.PREV_3 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_3/T1.PREV_3*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_3
		     , CASE WHEN T2.PREV_2 <![CDATA[>]]> 0 AND T1.PREV_2 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_2/T1.PREV_2*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_2
		     , CASE WHEN T2.PREV_1 <![CDATA[>]]> 0 AND T1.PREV_1 <![CDATA[>]]> 0 THEN RTRIM(TO_CHAR(ROUND(T2.PREV_1/T1.PREV_1*1000000,2),'FM999999999999990.99'),'.') ELSE '' END PREV_1
		     , CASE WHEN T2.YYYY > 0 AND T1.YYYY > 0 THEN RTRIM(TO_CHAR(ROUND(T2.YYYY/T1.YYYY*1000000,2),'FM999999999999990.99'),'.') ELSE '' END YYYY
		     , 'PPM' TITLE1
		     , PREMIER_SYS.GETMESSAGE('label.performance',#{LANG}) TITLE2
		     , '1' "id"
		  FROM (
		SELECT SUM(CASE WHEN SPMON LIKE #{PREV_9}||'%' THEN MENGE ELSE 0 END) PREV_9
		     , SUM(CASE WHEN SPMON LIKE #{PREV_8}||'%' THEN MENGE ELSE 0 END) PREV_8
		     , SUM(CASE WHEN SPMON LIKE #{PREV_7}||'%' THEN MENGE ELSE 0 END) PREV_7
		     , SUM(CASE WHEN SPMON LIKE #{PREV_6}||'%' THEN MENGE ELSE 0 END) PREV_6
		     , SUM(CASE WHEN SPMON LIKE #{PREV_5}||'%' THEN MENGE ELSE 0 END) PREV_5
		     , SUM(CASE WHEN SPMON LIKE #{PREV_4}||'%' THEN MENGE ELSE 0 END) PREV_4
		     , SUM(CASE WHEN SPMON LIKE #{PREV_3}||'%' THEN MENGE ELSE 0 END) PREV_3
		     , SUM(CASE WHEN SPMON LIKE #{PREV_2}||'%' THEN MENGE ELSE 0 END) PREV_2
		     , SUM(CASE WHEN SPMON LIKE #{PREV_1}||'%' THEN MENGE ELSE 0 END) PREV_1
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}  ||'%' THEN MENGE ELSE 0 END) YYYY
		  FROM ERP_BASIC 
		 WHERE GUBUN = 'MM'
		   AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT2 = 'Y')
		)T1, (
		SELECT SUM(CASE WHEN B_YMD LIKE #{PREV_9}||'%' THEN BAL_QTY ELSE 0 END) PREV_9
		     , SUM(CASE WHEN B_YMD LIKE #{PREV_8}||'%' THEN BAL_QTY ELSE 0 END) PREV_8
		     , SUM(CASE WHEN B_YMD LIKE #{PREV_7}||'%' THEN BAL_QTY ELSE 0 END) PREV_7
		     , SUM(CASE WHEN B_YMD LIKE #{PREV_6}||'%' THEN BAL_QTY ELSE 0 END) PREV_6
		     , SUM(CASE WHEN B_YMD LIKE #{PREV_5}||'%' THEN BAL_QTY ELSE 0 END) PREV_5
		     , SUM(CASE WHEN B_YMD LIKE #{PREV_4}||'%' THEN BAL_QTY ELSE 0 END) PREV_4
		     , SUM(CASE WHEN B_YMD LIKE #{PREV_3}||'%' THEN BAL_QTY ELSE 0 END) PREV_3
		     , SUM(CASE WHEN B_YMD LIKE #{PREV_2}||'%' THEN BAL_QTY ELSE 0 END) PREV_2
		     , SUM(CASE WHEN B_YMD LIKE #{PREV_1}||'%' THEN BAL_QTY ELSE 0 END) PREV_1
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}  ||'%' THEN BAL_QTY ELSE 0 END) YYYY
		  FROM Q_100 
		 WHERE COMPANYCD = #{COMPANYCD} AND GUBUN <![CDATA[<>]]> '0000002209' AND B_GBN IN ('0000002133','0000002130')
		)T2
	</select>
</mapper>
