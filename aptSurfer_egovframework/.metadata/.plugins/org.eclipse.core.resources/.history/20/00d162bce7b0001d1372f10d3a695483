<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dbvalley.premier.scm1.matlMst.mapper.MatlMstMapper">
     <select id="matlMstList" parameterType="json" resultType="json">
     	SELECT Z.*,ROWNUM RNO 
     	  FROM(
		     	SELECT A.*, B.DESCR AS  B_MTARTDESC,
		     	<!--  GET_CATALOG_NAME('SCM', 'SAP_PLANT', 'KO', A.WERKS) as WERKSNM, -->
		     	 PREMIER_SYS.GETCMPYNMBYCMPYSN(DECODE(A.WERKS,'1110','11','1210','13','1220','14','31')) WERKSNM,
		     		   SUBSTR(A.ERSDA,0,4)||'.'||SUBSTR(A.ERSDA,5,2)||'.'||SUBSTR(A.ERSDA,7,2) as ERSDAJ, SUBSTR(A.LAEDA,0,4)||'.'||SUBSTR(A.LAEDA,5,2)||'.'||SUBSTR(A.LAEDA,7,2) as LAEDAJ
		        FROM TSCM_M_MATL_MST_IF A, XM070_N B
		        WHERE SUBSTR(A.WERKS,0,1) = SUBSTR(B.COMPANYCD(+), 0,1)
		            AND A.MTART = B.MATERIAL_TYPE(+)
		            AND A.USE_YN = 'Y'
		            <if test="WERKS != null and WERKS != ''">
		            AND NVL2(#{WERKS}, A.WERKS, '*') = NVL2(#{WERKS}, #{WERKS}, '*')
		            </if>
		            <if test="PARTNO != null and PARTNO != ''">
		            AND NVL(upper(A.MATNR),'*') like '%'||NVL(upper(#{PARTNO}),nvl(upper(A.MATNR),'*'))||'%'
		            </if>
		            <if test="DESCR != null and DESCR != ''">
<!-- 				     AND NVL(upper(B.DESCR(+)),'*') like '%'||NVL(upper(#{DESCR}),nvl(upper(B.DESCR(+)),'*'))||'%' -->
				     AND upper(B.DESCR) like '%'||upper(#{DESCR})||'%'
					</if>	
		)Z
     </select>
       
</mapper>