<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dbvalley.premier.qms.qualityindex.mapper.QualityIndexMapper">
	
	<!-- #### 코드 참고 #################################################################################################################### -->
	
	<!-- 품질지수_구분 --> 
	<!-- ㄴ고객: 0000003573 || 공정: 0000003574 || 외주: 0000003575 --> 
	
	<!-- 품질지수_상세구분 -->
	<!-- ㄴ샤시: 0000003581 || 연료: 0000003582 || 페달: 0000003583 -->
	
	<!-- 부적합_발생분류 --> 
	<!-- ㄴ입고불량(고객): 0000002128 || 반송불량(고객): 0000002131 -->
	<!-- ㄴ공정불량(공정): 0000002129 || 외주불량(외주): 0000002548 -->
	
	<!-- 불량현상_품목 -->
	<!-- ㄴChassis: 0000003449 || SFT: 0000003450 || PFT: 0000003451 || SCR: 0000003452 -->
	<!-- ㄴHydrogen Tank: 0000003453 || BPC: 0000003454 || Pedal: 0000003455 -->
		
	<!-- ################################################################################################################################ -->
	<!-- 품질지수 > 품질실적 > 불량률추이(고객,공정,외주) > 부적합 목록 조회 -->
	<select id="selectQualityIndexNonList" parameterType="json" resultType="json">
		SELECT A.D_YMD||'-'||LPAD(A.SER,3,0) AS SEL_NO,
		       PREMIER_SYS.GET_PLANT_NAME(A.COMPANYCD, A.PLANT) AS PLANT_NM,
		       PREMIER_SYS.GET_ITGR_CODE_NAME(A.B_GBN, #{LANG}) AS B_GBN_NM,
		       A.B_PLACE_NAME,
		       A.KINDCD,
		       A.PARTNO,
		       A.PARTNM,
		       PREMIER_SYS.GET_ITGR_CODE_NAME(A.TYPE_GBN, #{LANG}) AS TYPE_GBN_NM,
		       TO_CHAR( A.K_QTY , '999,999,999,999,999') K_QTY
		  FROM Q_100 A 
		 WHERE A.COMPANYCD = #{COMPANYCD}
		   AND A.B_YMD LIKE REPLACE(#{YYYYMM},'-','')||'%'
		   <if test="HQ != null and HQ != ''">
		   AND (A.PLANT IN (SELECT PLANT_CD FROM PREMIER_SYS.COM_PLANT_INFO WHERE MGT1 = #{HQ}) AND A.PLANT LIKE '%'||#{PLANT}||'%')
		   </if>
		   <choose>
		        <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131')
		        </when>
		        <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
		        </when>
		        <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'     
		   AND GUBUN <![CDATA[<>]]> '0000002209'
		        </when>
		    </choose>
		 ORDER BY B_YMD, SER
	</select>
	<!-- 품질지수 > 품질실적 > 품질비용(항목별추이) 데이터 조회-->
	<select id="selectQualityCostItemData" parameterType="json" resultType="json">
		SELECT R.*, PREMIER_SYS.GET_ITGR_CODE_NAME(R.Q_TYPE_UP,#{LANG}) Q_TYPE_UP_NM
		FROM (
		SELECT A.Q_TYPE_UP
		     , NVL(SUM(CASE WHEN YYYY= #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ),0) PREV
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ),0) YYYY
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G01 ELSE 0 END ),0) G01
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G02 ELSE 0 END ),0) G02
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G03 ELSE 0 END ),0) G03
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G04 ELSE 0 END ),0) G04
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G05 ELSE 0 END ),0) G05
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G06 ELSE 0 END ),0) G06
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G07 ELSE 0 END ),0) G07
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G08 ELSE 0 END ),0) G08
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G09 ELSE 0 END ),0) G09
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G10 ELSE 0 END ),0) G10
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G11 ELSE 0 END ),0) G11
		     , NVL(SUM(CASE WHEN YYYY= #{YYYY} THEN G12 ELSE 0 END ),0) G12
		  FROM Q_060 A, COM_PLANT_INFO B
 		 WHERE A.COMPANYCD = B.CMPY_SN
   		   AND A.PLANT = B.PLANT_CD
		   AND A.COMPANYCD = #{COMPANYCD}
		<choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'C' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'F' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'P' </otherwise>
				</choose>
			</when>
		</choose>
		   AND A.Q_GUBUN = 'B'
		   AND (A.Q_TYPE_UP <![CDATA[<>]]> '0000003627' AND A.Q_TYPE_UP <![CDATA[<>]]> '0000003596' AND A.Q_TYPE_UP LIKE '%'||#{Q_TYPE_UP}||'%')
		 GROUP BY A.Q_TYPE_UP
		) R
		ORDER BY R.Q_TYPE_UP
	</select>
	<!-- 품질지수 > 품질실적 > 품질비용(본부별추이) 데이터 조회 -->
	<select id="selectQualityCostHqData" parameterType="json" resultType="json">
		SELECT 'S' mgt1
		     , SUM(CASE WHEN YYYY= #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) PREV
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) YYYY
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G01 ELSE 0 END ) G01
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G02 ELSE 0 END ) G02
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G03 ELSE 0 END ) G03
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G04 ELSE 0 END ) G04
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G05 ELSE 0 END ) G05
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G06 ELSE 0 END ) G06
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G07 ELSE 0 END ) G07
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G08 ELSE 0 END ) G08
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G09 ELSE 0 END ) G09
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G10 ELSE 0 END ) G10
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G11 ELSE 0 END ) G11
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G12 ELSE 0 END ) G12
		FROM Q_060 A, COM_PLANT_INFO B
 	   WHERE A.COMPANYCD = B.CMPY_SN AND A.PLANT = B.PLANT_CD AND A.COMPANYCD = #{COMPANYCD} AND A.Q_GUBUN = 'B' AND A.Q_TYPE_UP = '0000003627'
 	    <choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'C' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'F' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'P' </otherwise>
				</choose>
			</when>
		</choose>
		UNION ALL
		SELECT 'R' mgt1
		     , SUM(CASE WHEN YYYY= #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) PREV
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) YYYY
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G01 ELSE 0 END ) G01
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G02 ELSE 0 END ) G02
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G03 ELSE 0 END ) G03
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G04 ELSE 0 END ) G04
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G05 ELSE 0 END ) G05
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G06 ELSE 0 END ) G06
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G07 ELSE 0 END ) G07
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G08 ELSE 0 END ) G08
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G09 ELSE 0 END ) G09
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G10 ELSE 0 END ) G10
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G11 ELSE 0 END ) G11
		     , SUM(CASE WHEN YYYY= #{YYYY} THEN G12 ELSE 0 END ) G12
		FROM Q_060 A, COM_PLANT_INFO B
 	   WHERE A.COMPANYCD = B.CMPY_SN AND A.PLANT = B.PLANT_CD AND A.COMPANYCD = #{COMPANYCD} AND A.Q_GUBUN = 'B' AND A.Q_TYPE_UP = '0000003596'
 	    <choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'C' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'F' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'P' </otherwise>
				</choose>
			</when>
		</choose>
		UNION ALL
		SELECT 'T' mgt1
		     , SUM(CASE WHEN YYYY = #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) PREV
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) YYYY
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01 ELSE 0 END ) G01
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G02 ELSE 0 END ) G02
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G03 ELSE 0 END ) G03
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G04 ELSE 0 END ) G04
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G05 ELSE 0 END ) G05
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G06 ELSE 0 END ) G06
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G07 ELSE 0 END ) G07
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G08 ELSE 0 END ) G08
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G09 ELSE 0 END ) G09
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G10 ELSE 0 END ) G10
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G11 ELSE 0 END ) G11
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G12 ELSE 0 END ) G12
		  FROM Q_060 A, COM_PLANT_INFO B
		 WHERE A.PLANT = B.PLANT_CD AND A.COMPANYCD = B.CMPY_SN AND COMPANYCD = #{COMPANYCD} AND Q_GUBUN = 'B' AND A.MGT1 IN ('A','B','C')
		   AND A.Q_TYPE_UP LIKE '%'||#{Q_TYPE_UP}||'%'
		 <choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'C' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'F' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'P' </otherwise>
				</choose>
			</when>
		</choose>  
		UNION ALL
		SELECT B.MGT1
		     , SUM(CASE WHEN YYYY = #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END) PREV
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END) YYYY
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01 ELSE 0 END) G01
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G02 ELSE 0 END) G02
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G03 ELSE 0 END) G03
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G04 ELSE 0 END) G04
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G05 ELSE 0 END) G05
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G06 ELSE 0 END) G06
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G07 ELSE 0 END) G07
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G08 ELSE 0 END) G08
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G09 ELSE 0 END) G09
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G10 ELSE 0 END) G10
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G11 ELSE 0 END) G11
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G12 ELSE 0 END) G12
		  FROM Q_060 A, COM_PLANT_INFO B
		 WHERE A.PLANT = B.PLANT_CD
		   AND A.COMPANYCD = B.CMPY_SN
		   AND A.COMPANYCD = #{COMPANYCD}
		   AND A.MGT1 IN ('A','B','C')
		   AND A.Q_GUBUN = 'B'
		   AND A.Q_TYPE_UP LIKE '%'||#{Q_TYPE_UP}||'%'
	   <choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'C' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'F' </otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''"> AND A.PLANT = #{PLANT} </when>
					<otherwise> AND B.MGT1 = 'P' </otherwise>
				</choose>
			</when>
		</choose>
		 GROUP BY B.MGT1
	</select>
	<!-- 품질지수 > 품질실적 > 품질비용(유형별실적) 데이터 조회 -->
	<select id="selectQualityCostTypeData" parameterType="json" resultType="json">
		SELECT PREMIER_SYS.GETMESSAGE('label.sales.billion',#{LANG}) TITLE1, '' TITLE2, '' TITLE3, '-' q_type_up, '-' mgt1
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END )) PREV_B
		     , '-' YYYY_A
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END )) YYYY_B
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} THEN G${MM} ELSE 0 END )) MM
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C') THEN G${MM} ELSE 0 END )) MM_C
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F') THEN G${MM} ELSE 0 END )) MM_F
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P') THEN G${MM} ELSE 0 END )) MM_P
		     , '-' YYYY_PCT
		     , '-' MM_PCT
		     , '-' MM_C_PCT
		     , '-' MM_F_PCT
		     , '-' MM_P_PCT
		FROM Q_060
		 WHERE COMPANYCD = #{COMPANYCD}
		   AND Q_GUBUN = 'B'
		   AND Q_TYPE_UP = '0000003627'
		UNION ALL
		SELECT PREMIER_SYS.GETMESSAGE('label.quality.cost.recovery',#{LANG}) TITLE1, '' TITLE2, '' TITLE3, '-' q_type_up, '-' mgt1, T.*
		     , RTRIM(TO_CHAR(NVL(ROUND(T.YYYY_B / 
		            (SELECT SUM(G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12) 
		               FROM Q_060 WHERE COMPANYCD = #{COMPANYCD} AND YYYY= #{YYYY} AND Q_GUBUN = 'B' AND Q_TYPE_UP = '0000003627')
		        ,2),0),'FM999999999999990.99'),'.')||'%' AS YYYY_PCT
		     , RTRIM(TO_CHAR(NVL(ROUND(T.MM / 
		            (SELECT SUM(G${MM}) FROM Q_060 WHERE COMPANYCD = #{COMPANYCD} AND YYYY= #{YYYY} AND Q_GUBUN = 'B' AND Q_TYPE_UP = '0000003627')
		        ,2),0),'FM999999999999990.99'),'.')||'%' AS MM_PCT
		     , RTRIM(TO_CHAR(NVL(ROUND(T.MM_C / 
		            (SELECT SUM(G${MM}) FROM Q_060 
		              WHERE COMPANYCD = #{COMPANYCD} AND YYYY= #{YYYY} AND Q_GUBUN = 'B' AND Q_TYPE_UP = '0000003627'
		                AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C'))
		        ,2),0),'FM999999999999990.99'),'.')||'%' AS MM_C_PCT
		     , RTRIM(TO_CHAR(NVL(ROUND(T.MM_F / 
		            (SELECT SUM(G${MM}) FROM Q_060 WHERE COMPANYCD = #{COMPANYCD} AND YYYY= #{YYYY} AND Q_GUBUN = 'B' AND Q_TYPE_UP = '0000003627'
		                AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F'))
		        ,2),0),'FM999999999999990.99'),'.')||'%' AS MM_F_PCT
		     , RTRIM(TO_CHAR(NVL(ROUND(T.MM_P / 
		            (SELECT SUM(G${MM}) FROM Q_060 WHERE COMPANYCD = #{COMPANYCD} AND YYYY= #{YYYY} AND Q_GUBUN = 'B' AND Q_TYPE_UP = '0000003627'
		                AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P'))
		        ,2),0),'FM999999999999990.99'),'.')||'%' AS MM_P_PCT
		  FROM (
		SELECT TO_CHAR(SUM(CASE WHEN YYYY= #{PREV} AND Q_GUBUN = 'B' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END )) PREV_B
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'A' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END )) YYYY_A
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END )) YYYY_B
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' THEN G${MM} ELSE 0 END )) MM
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C') THEN G${MM} ELSE 0 END )) MM_C
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F') THEN G${MM} ELSE 0 END )) MM_F
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P') THEN G${MM} ELSE 0 END )) MM_P
		  FROM Q_060
		 WHERE COMPANYCD = #{COMPANYCD} AND MGT1 IS NOT NULL 
		 AND MGT1 in ('A','B','C')
		    )T
		UNION ALL
		SELECT PREMIER_SYS.GETMESSAGE('label.sum',#{LANG}) TITLE1, PREMIER_SYS.GET_ITGR_CODE_NAME(R2.Q_TYPE_UP,#{LANG}) TITLE2
		     , CASE MGT1 WHEN '1' THEN PREMIER_SYS.GETMESSAGE('label.sum3',#{LANG})
		                 WHEN 'A' THEN CASE Q_TYPE_UP WHEN '0000003592' THEN PREMIER_SYS.GETMESSAGE('label.tooldis.loss',#{LANG})
		                                              WHEN '0000003593' THEN PREMIER_SYS.GETMESSAGE('label.warranty.claim',#{LANG})
		                                              WHEN '0000003594' THEN PREMIER_SYS.GETMESSAGE('label.reliability.qualitytest',#{LANG})
		                                              WHEN '0000003595' THEN PREMIER_SYS.GETMESSAGE('label.quality.business.trip',#{LANG})
		                                END
		                 WHEN 'B' THEN CASE Q_TYPE_UP WHEN '0000003592' THEN PREMIER_SYS.GETMESSAGE('label.rework.part.cost',#{LANG})
		                                              WHEN '0000003593' THEN PREMIER_SYS.GETMESSAGE('label.campaign.claim',#{LANG})
		                                              WHEN '0000003594' THEN PREMIER_SYS.GETMESSAGE('label.to.firstArticle',#{LANG})
		                                              WHEN '0000003595' THEN PREMIER_SYS.GETMESSAGE('label.buy.meter.etc',#{LANG})
		                                END
		                 WHEN 'C' THEN CASE Q_TYPE_UP WHEN '0000003592' THEN PREMIER_SYS.GETMESSAGE('label.cust.plant.claim',#{LANG})
		                                              WHEN '0000003594' THEN PREMIER_SYS.GETMESSAGE('label.cust.response.return',#{LANG})
		                                END
		       END TITLE3 
		     , R2.* 
		  FROM (
		SELECT R.Q_TYPE_UP, MGT1
		     , TO_CHAR(PREV_B) PREV_B, TO_CHAR(YYYY_A) YYYY_A, TO_CHAR(YYYY_B) YYYY_B
		     , TO_CHAR(MM) MM, TO_CHAR(MM_C) MM_C, TO_CHAR(MM_F) MM_F, TO_CHAR(MM_P) MM_P
		     , TO_CHAR(YYYY_PCT) YYYY_PCT, TO_CHAR(MM_PCT) MM_PCT, TO_CHAR(MM_C_PCT) MM_C_PCT, TO_CHAR(MM_F_PCT) MM_F_PCT, TO_CHAR(MM_P_PCT) MM_P_PCT
		 FROM (
		SELECT T.*
		     , '' YYYY_PCT
		     , '' MM_PCT
		     , '' MM_C_PCT
		     , '' MM_F_PCT
		     , '' MM_P_PCT
		  FROM (
		SELECT Q_TYPE_UP, MGT1
		     , SUM(CASE WHEN YYYY= #{PREV} AND Q_GUBUN = 'B' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) PREV_B
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'A' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) YYYY_A
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) YYYY_B
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' THEN G${MM} ELSE 0 END ) MM
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C') THEN G${MM} ELSE 0 END ) MM_C
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F') THEN G${MM} ELSE 0 END ) MM_F
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P') THEN G${MM} ELSE 0 END ) MM_P
		  FROM Q_060
		 WHERE COMPANYCD = #{COMPANYCD} AND MGT1 IS NOT NULL 
		 AND MGT1 <![CDATA[<>]]> 'N'
		 GROUP BY Q_TYPE_UP, MGT1
		)T
		UNION ALL
		SELECT T.Q_TYPE_UP, T.MGT1, T.PREV_B, T.YYYY_A, T.YYYY_B, T.MM, T.MM_C, T.MM_F, T.MM_P
		     , RTRIM(TO_CHAR(NVL(ROUND(T.YYYY_B / 
		            (SELECT SUM(G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12) FROM Q_060 WHERE YYYY = #{YYYY} AND Q_GUBUN = 'B' AND MGT1 IN ('A','B','C'))
		        ,2),0)*100,'FM999999999999990.99'),'.') AS YYYY_PCT
		     , RTRIM(TO_CHAR(NVL(ROUND(T.MM / 
		            (SELECT SUM(G${MM}) FROM Q_060 WHERE YYYY = #{YYYY} AND Q_GUBUN = 'B' AND MGT1 IN ('A','B','C'))
		        ,2),0)*100,'FM999999999999990.99'),'.') AS MM_PCT
		     , RTRIM(TO_CHAR(NVL(ROUND(T.MM_C / 
		            (SELECT SUM(G${MM}) FROM Q_060 WHERE YYYY = #{YYYY} AND Q_GUBUN = 'B' AND MGT1 IN ('A','B','C') AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C'))
		        ,2),0)*100,'FM999999999999990.99'),'.') AS MM_C_PCT
		     , RTRIM(TO_CHAR(NVL(ROUND(T.MM_F / 
		            (SELECT SUM(G${MM}) FROM Q_060 WHERE YYYY = #{YYYY} AND Q_GUBUN = 'B' AND MGT1 IN ('A','B','C') AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F'))
		        ,2),0)*100,'FM999999999999990.99'),'.') AS MM_F_PCT
		     , RTRIM(TO_CHAR(NVL(ROUND(T.MM_P / 
		            (SELECT SUM(G${MM}) FROM Q_060 WHERE YYYY = #{YYYY} AND Q_GUBUN = 'B' AND MGT1 IN ('A','B','C') AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P'))
		        ,2),0)*100,'FM999999999999990.99'),'.') AS MM_P_PCT
		  FROM (
		SELECT Q_TYPE_UP, '1' MGT1
		     , SUM(CASE WHEN YYYY= #{PREV} AND Q_GUBUN = 'B' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) PREV_B
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'A' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) YYYY_A
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END ) YYYY_B
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' THEN G${MM} ELSE 0 END ) MM
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C') THEN G${MM} ELSE 0 END ) MM_C
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F') THEN G${MM} ELSE 0 END ) MM_F
		     , SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P') THEN G${MM} ELSE 0 END ) MM_P
		  FROM Q_060
		 WHERE COMPANYCD = #{COMPANYCD} AND MGT1 IS NOT NULL 
		   AND MGT1 <![CDATA[<>]]> 'N'
		 GROUP BY Q_TYPE_UP
		 ORDER BY Q_TYPE_UP
		)T  
		)R
		ORDER BY Q_TYPE_UP, MGT1
		)R2
		UNION ALL
		SELECT PREMIER_SYS.GETMESSAGE('label.recovery.cost.partner.liquidation',#{LANG}) TITLE1, '' TITLE2, '' TITLE3, q_type_up, '-' mgt1
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{PREV} AND Q_GUBUN = 'B' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END )) PREV_B
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'A' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END )) YYYY_A
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END )) YYYY_B
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' THEN G${MM} ELSE 0 END )) MM
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C') THEN G${MM} ELSE 0 END )) MM_C
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F') THEN G${MM} ELSE 0 END )) MM_F
		     , TO_CHAR(SUM(CASE WHEN YYYY= #{YYYY} AND Q_GUBUN = 'B' AND PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P') THEN G${MM} ELSE 0 END )) MM_P
		     , '-' YYYY_PCT
		     , '-' MM_PCT
		     , '-' MM_C_PCT
		     , '-' MM_F_PCT
		     , '-' MM_P_PCT
		FROM Q_060
		 WHERE COMPANYCD = #{COMPANYCD}
		   AND Q_TYPE_UP = '0000003596'
		 GROUP BY Q_TYPE_UP
	</select>
	<!-- 품질지수 > 품질관리 사업실적 > 품질비용 > 품질비용 입력 데이터 초기설정  -->
	<update id="initQualityCostDetailData" parameterType="json">
		MERGE INTO Q_060 A USING (
		SELECT #{COMPANYCD} AS COMPANYCD
		      ,#{PLANT} AS PLANT
		      ,#{YYYY} AS YYYY
		      ,'0000003627' AS Q_TYPE_UP
		      ,'0000003627' AS Q_TYPE
		      ,#{Q_GUBUN} AS Q_GUBUN
		      ,'0' AS G01
		      ,'0' AS G02
		      ,'0' AS G03
		      ,'0' AS G04
		      ,'0' AS G05
		      ,'0' AS G06
		      ,'0' AS G07
		      ,'0' AS G08
		      ,'0' AS G09
		      ,'0' AS G10
		      ,'0' AS G11
		      ,'0' AS G12
		      ,#{ACC_NO} AS CREATE_ACC_NO
		      ,SYSDATE AS CREATE_DATE
		      ,#{ACC_NO} AS UPDATE_ACC_NO
		      ,SYSDATE AS UPDATE_DATE
		FROM DUAL ) D
		ON (A.COMPANYCD = D.COMPANYCD
		AND A.PLANT = D.PLANT
		AND A.YYYY = D.YYYY
		AND A.Q_TYPE_UP = D.Q_TYPE_UP
		AND A.Q_TYPE = D.Q_TYPE
		AND A.Q_GUBUN = D.Q_GUBUN
		)
		WHEN NOT MATCHED THEN
		INSERT(A.COMPANYCD, A.PLANT, A.YYYY, A.Q_TYPE, A.Q_TYPE_UP, A.Q_GUBUN, A.G01, A.G02, A.G03, A.G04, A.G05, A.G06, A.G07, A.G08, A.G09, A.G10, A.G11, A.G12, A.CREATE_ACC_NO, A.CREATE_DATE)
		VALUES(D.COMPANYCD, D.PLANT, D.YYYY, D.Q_TYPE, D.Q_TYPE_UP, D.Q_GUBUN, D.G01, D.G02, D.G03, D.G04, D.G05, D.G06, D.G07, D.G08, D.G09, D.G10, D.G11, D.G12, D.CREATE_ACC_NO, D.CREATE_DATE)
	</update>
	<!-- 품질지수 > 품질관리 사업실적 > 품질비용 데이터 조회 -->
	<select id="selectQualityCostData" parameterType="json" resultType="json">
		SELECT R.TITLE1, R.TITLE2, R.TITLE3, R.TITLE4, R.Q_TYPE_UP, R.Q_GUBUN
			 , ROUND(R.PREV,2) PREV
			 , ROUND(R.TOT ,2) TOT
			 , ROUND(R.G01 ,2) G01
			 , ROUND(R.G02 ,2) G02
			 , ROUND(R.G03 ,2) G03
			 , ROUND(R.G04 ,2) G04
			 , ROUND(R.G05 ,2) G05
			 , ROUND(R.G06 ,2) G06
			 , ROUND(R.G07 ,2) G07
			 , ROUND(R.G08 ,2) G08
			 , ROUND(R.G09 ,2) G09
			 , ROUND(R.G10 ,2) G10
			 , ROUND(R.G11 ,2) G11
			 , ROUND(R.G12 ,2) G12
			 , NVL(PREMIER_SYS.GET_ITGR_CODE_MGT(R.Q_TYPE_UP, #{LANG}, 1),'Y') MGT1  
			 , #{COMPANYCD} COMPANYCD
			 , #{PLANT} PLANT
			 , #{YYYY} YYYY
		  FROM (
		SELECT '-' Q_TYPE_UP, 'A' Q_GUBUN 
		     , SUM(CASE WHEN YYYY = #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END) PREV
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END) TOT
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01 ELSE 0 END) G01
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G02 ELSE 0 END) G02
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G03 ELSE 0 END) G03
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G04 ELSE 0 END) G04
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G05 ELSE 0 END) G05
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G06 ELSE 0 END) G06
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G07 ELSE 0 END) G07
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G08 ELSE 0 END) G08
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G09 ELSE 0 END) G09
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G10 ELSE 0 END) G10
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G11 ELSE 0 END) G11
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G12 ELSE 0 END) G12
		     , PREMIER_SYS.GETMESSAGE('label.quality.cost',#{LANG}) TITLE1 
		     , PREMIER_SYS.GETMESSAGE('label.sum',#{LANG}) TITLE2
		     , PREMIER_SYS.GETMESSAGE('label.goal',#{LANG}) TITLE3 
		     , PREMIER_SYS.GETMESSAGE('label.sum2',#{LANG}) TITLE4
		  FROM Q_060 
		 WHERE COMPANYCD = #{COMPANYCD} AND PLANT = #{PLANT}
		   AND Q_TYPE_UP <![CDATA[<>]]> '0000003596'
		   AND Q_TYPE_UP <![CDATA[<>]]> '0000003627'
		   AND Q_GUBUN = 'A'
		UNION ALL
		SELECT '-' Q_TYPE_UP, 'B' Q_GUBUN 
		     , SUM(CASE WHEN YYYY = #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END) PREV
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END) TOT
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01 ELSE 0 END) G01
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G02 ELSE 0 END) G02
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G03 ELSE 0 END) G03
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G04 ELSE 0 END) G04
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G05 ELSE 0 END) G05
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G06 ELSE 0 END) G06
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G07 ELSE 0 END) G07
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G08 ELSE 0 END) G08
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G09 ELSE 0 END) G09
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G10 ELSE 0 END) G10
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G11 ELSE 0 END) G11
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G12 ELSE 0 END) G12
		     , PREMIER_SYS.GETMESSAGE('label.quality.cost',#{LANG}) TITLE1
		     , PREMIER_SYS.GETMESSAGE('label.sum',#{LANG}) TITLE2
		     , PREMIER_SYS.GETMESSAGE('label.performance',#{LANG}) TITLE3 
		     , PREMIER_SYS.GETMESSAGE('label.sum2',#{LANG}) TITLE4
		  FROM Q_060 
		 WHERE COMPANYCD = #{COMPANYCD} AND PLANT = #{PLANT}
		   AND Q_TYPE_UP <![CDATA[<>]]> '0000003596'
		   AND Q_TYPE_UP <![CDATA[<>]]> '0000003627'
		   AND Q_GUBUN = 'B'
		UNION ALL
		SELECT T1.*
		     , PREMIER_SYS.GETMESSAGE('label.quality.cost',#{LANG}) TITLE1
		     , PREMIER_SYS.GET_ITGR_CODE_NAME(T1.Q_TYPE_UP,#{LANG}) TITLE2
		     , DECODE(T1.Q_GUBUN, 'A', PREMIER_SYS.GETMESSAGE('label.goal',#{LANG}), PREMIER_SYS.GETMESSAGE('label.performance',#{LANG})) TITLE3
		     , CASE WHEN T1.Q_TYPE_UP = '0000003627' THEN 
		     		CASE WHEN Q_GUBUN = 'A' THEN PREMIER_SYS.GETMESSAGE('label.cost',#{LANG})||'(%)'
		     		ELSE PREMIER_SYS.GETMESSAGE('label.sales',#{LANG}) END
		       ELSE PREMIER_SYS.GETMESSAGE('label.sum2',#{LANG}) END TITLE4
		  FROM (
		SELECT Q_TYPE_UP, Q_GUBUN
		     , CASE WHEN Q_GUBUN = 'A' AND Q_TYPE_UP = '0000003627' THEN SUM(CASE WHEN YYYY = #{PREV} THEN (G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12 ELSE 0 END)
		       ELSE SUM(CASE WHEN YYYY = #{PREV} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END) END PREV
		     , CASE WHEN Q_GUBUN = 'A' AND Q_TYPE_UP = '0000003627' THEN SUM(CASE WHEN YYYY = #{YYYY} THEN (G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12 ELSE 0 END)
		       ELSE SUM(CASE WHEN YYYY = #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END) END TOT
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G01 ELSE 0 END) G01
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G02 ELSE 0 END) G02
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G03 ELSE 0 END) G03
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G04 ELSE 0 END) G04
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G05 ELSE 0 END) G05
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G06 ELSE 0 END) G06
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G07 ELSE 0 END) G07
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G08 ELSE 0 END) G08
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G09 ELSE 0 END) G09
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G10 ELSE 0 END) G10
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G11 ELSE 0 END) G11
		     , SUM(CASE WHEN YYYY = #{YYYY} THEN G12 ELSE 0 END) G12
		  FROM Q_060 
		 WHERE COMPANYCD = #{COMPANYCD} AND PLANT = #{PLANT}
		 GROUP BY Q_TYPE_UP, Q_GUBUN
		 ORDER BY Q_TYPE_UP, Q_GUBUN
		)T1
		)R
	</select>
	<!-- 품질지수 > 품질관리 사업실적 > 품질비용 > 품질비용 상세 데이터 저장 -->
	<update id="mergeQualityCostDetailData" parameterType="json">
		MERGE INTO Q_060 A USING (
		SELECT #{COMPANYCD} AS COMPANYCD
		      ,#{PLANT} AS PLANT
		      ,#{YYYY} AS YYYY
		      ,#{Q_TYPE_UP} AS Q_TYPE_UP
		      ,#{Q_TYPE} AS Q_TYPE
		      ,#{Q_GUBUN} AS Q_GUBUN
		      ,#{G01} AS G01
		      ,#{G02} AS G02
		      ,#{G03} AS G03
		      ,#{G04} AS G04
		      ,#{G05} AS G05
		      ,#{G06} AS G06
		      ,#{G07} AS G07
		      ,#{G08} AS G08
		      ,#{G09} AS G09
		      ,#{G10} AS G10
		      ,#{G11} AS G11
		      ,#{G12} AS G12
		      ,#{MGT1} AS MGT1
		      ,#{ACC_NO} AS CREATE_ACC_NO
		      ,SYSDATE AS CREATE_DATE
		      ,#{ACC_NO} AS UPDATE_ACC_NO
		      ,SYSDATE AS UPDATE_DATE
		FROM DUAL ) D
		ON (A.COMPANYCD = D.COMPANYCD
		AND A.PLANT = D.PLANT
		AND A.YYYY = D.YYYY
		AND A.Q_TYPE_UP = D.Q_TYPE_UP
		AND A.Q_TYPE = D.Q_TYPE
		AND A.Q_GUBUN = D.Q_GUBUN
		)
		WHEN MATCHED THEN
		  UPDATE SET A.G01 = D.G01
		            ,A.G02 = D.G02
		            ,A.G03 = D.G03
		            ,A.G04 = D.G04
		            ,A.G05 = D.G05
		            ,A.G06 = D.G06
		            ,A.G07 = D.G07
		            ,A.G08 = D.G08
		            ,A.G09 = D.G09
		            ,A.G10 = D.G10
		            ,A.G11 = D.G11
		            ,A.G12 = D.G12
		            ,A.MGT1 = D.MGT1
		            ,A.UPDATE_ACC_NO = D.UPDATE_ACC_NO
		            ,A.UPDATE_DATE = D.UPDATE_DATE
		WHEN NOT MATCHED THEN
		INSERT(A.COMPANYCD, A.PLANT, A.YYYY, A.Q_TYPE, A.Q_TYPE_UP, A.Q_GUBUN, A.G01, A.G02, A.G03, A.G04, A.G05, A.G06, A.G07, A.G08, A.G09, A.G10, A.G11, A.G12, A.MGT1, A.CREATE_ACC_NO, A.CREATE_DATE)
		VALUES(D.COMPANYCD, D.PLANT, D.YYYY, D.Q_TYPE, D.Q_TYPE_UP, D.Q_GUBUN, D.G01, D.G02, D.G03, D.G04, D.G05, D.G06, D.G07, D.G08, D.G09, D.G10, D.G11, D.G12, D.MGT1, D.CREATE_ACC_NO, D.CREATE_DATE)
				
	</update>
	<!-- 품질지수 > 품질관리 사업실적 > 품질비용 > 품질비용 상세 데이터 조회 -->
	<select id="selectQualityCostDetailData" parameterType="json" resultType="json">
		SELECT R2.* FROM (
		SELECT #{COMPANYCD} COMPANYCD, #{PLANT} PLANT, #{YYYY} YYYY, PREMIER_SYS.GETMESSAGE('label.million',#{LANG}) TITLE4, R.* FROM (
		SELECT T1.RNO, T1.MGT1, T1.Q_TYPE, T1.Q_TYPE_UP, T1.TITLE1, T1.TITLE2, NVL(T2.Q_GUBUN,'A') Q_GUBUN, PREMIER_SYS.GETMESSAGE('label.goal',#{LANG}) TITLE3
		     , SUM(CASE WHEN T2.YYYY = #{PREV} THEN (T2.G01+T2.G02+T2.G03+T2.G04+T2.G05+T2.G06+T2.G07+T2.G08+T2.G09+T2.G10+T2.G11+T2.G12) ELSE 0 END) PREV
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN (T2.G01+T2.G02+T2.G03+T2.G04+T2.G05+T2.G06+T2.G07+T2.G08+T2.G09+T2.G10+T2.G11+T2.G12) ELSE 0 END) TOT
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G01 ELSE 0 END) G01
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G02 ELSE 0 END) G02
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G03 ELSE 0 END) G03
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G04 ELSE 0 END) G04
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G05 ELSE 0 END) G05
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G06 ELSE 0 END) G06
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G07 ELSE 0 END) G07
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G08 ELSE 0 END) G08
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G09 ELSE 0 END) G09
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G10 ELSE 0 END) G10
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G11 ELSE 0 END) G11
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G12 ELSE 0 END) G12 
		FROM (
		SELECT ROWNUM RNO
		     , A.CODE_SEQ Q_TYPE
		     , A.CODE_SEQ_UP Q_TYPE_UP
		     , A.MGT1
		     , PREMIER_SYS.GET_ITGR_CODE_NAME(A.CODE_SEQ_UP,#{LANG}) TITLE1
		     , A.CODE_NAME TITLE2
		  FROM (
		SELECT MGMT.CODE_SEQ_UP, MGMT.CODE_SEQ, LANG.CODE_NAME, MGMT.CODE_ORDERNO, MGMT.MGT1, LEVEL LV
		  FROM PREMIER_SYS.SYS_ITGR_CODE_MGMT MGMT, PREMIER_SYS.SYS_ITGR_CODE_LANG LANG
		 WHERE MGMT.CODE_SEQ = LANG.CODE_SEQ
		   AND LANG.CODE_SEQ_LANG = #{LANG}
		   AND MGMT.ACTIVE_FLAG = 'A'
		 START WITH MGMT.CODE_SEQ_UP = '0000003591' AND LANG.CODE_SEQ_LANG = #{LANG} AND MGMT.ACTIVE_FLAG = 'A'
		CONNECT BY PRIOR MGMT.CODE_SEQ = MGMT.CODE_SEQ_UP
		ORDER SIBLINGS BY CODE_ORDERNO
		) A
		WHERE A.LV > 1
		) T1, (SELECT A.* FROM Q_060 A WHERE COMPANYCD = #{COMPANYCD} AND PLANT = #{PLANT} AND Q_GUBUN = 'A') T2
		WHERE T1.Q_TYPE = T2.Q_TYPE(+)
		GROUP BY T1.RNO, T1.MGT1, T1.Q_TYPE, T1.Q_TYPE_UP, T1.TITLE1, T1.TITLE2, T2.Q_GUBUN
		UNION ALL
		SELECT T1.RNO, T1.MGT1, T1.Q_TYPE, T1.Q_TYPE_UP, T1.TITLE1, T1.TITLE2, NVL(T2.Q_GUBUN,'B') Q_GUBUN, PREMIER_SYS.GETMESSAGE('label.performance',#{LANG}) TITLE3
		     , SUM(CASE WHEN T2.YYYY = #{PREV} THEN (T2.G01+T2.G02+T2.G03+T2.G04+T2.G05+T2.G06+T2.G07+T2.G08+T2.G09+T2.G10+T2.G11+T2.G12) ELSE 0 END) PREV
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN (T2.G01+T2.G02+T2.G03+T2.G04+T2.G05+T2.G06+T2.G07+T2.G08+T2.G09+T2.G10+T2.G11+T2.G12) ELSE 0 END) TOT
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G01 ELSE 0 END) G01
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G02 ELSE 0 END) G02
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G03 ELSE 0 END) G03
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G04 ELSE 0 END) G04
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G05 ELSE 0 END) G05
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G06 ELSE 0 END) G06
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G07 ELSE 0 END) G07
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G08 ELSE 0 END) G08
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G09 ELSE 0 END) G09
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G10 ELSE 0 END) G10
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G11 ELSE 0 END) G11
		     , SUM(CASE WHEN T2.YYYY = #{YYYY} THEN T2.G12 ELSE 0 END) G12 
		FROM (
		SELECT ROWNUM RNO
		     , A.CODE_SEQ Q_TYPE
		     , A.CODE_SEQ_UP Q_TYPE_UP
		     , A.MGT1
		     , PREMIER_SYS.GET_ITGR_CODE_NAME(A.CODE_SEQ_UP,#{LANG}) TITLE1
		     , A.CODE_NAME TITLE2
		  FROM (
		SELECT MGMT.CODE_SEQ_UP, MGMT.CODE_SEQ, LANG.CODE_NAME, MGMT.CODE_ORDERNO, MGMT.MGT1, LEVEL LV
		  FROM PREMIER_SYS.SYS_ITGR_CODE_MGMT MGMT, PREMIER_SYS.SYS_ITGR_CODE_LANG LANG
		 WHERE MGMT.CODE_SEQ = LANG.CODE_SEQ
		   AND LANG.CODE_SEQ_LANG = #{LANG}
		   AND MGMT.ACTIVE_FLAG = 'A'
		 START WITH MGMT.CODE_SEQ_UP = '0000003591' AND LANG.CODE_SEQ_LANG = #{LANG} AND MGMT.ACTIVE_FLAG = 'A'
		CONNECT BY PRIOR MGMT.CODE_SEQ = MGMT.CODE_SEQ_UP
		ORDER SIBLINGS BY CODE_ORDERNO
		) A
		WHERE A.LV > 1
		) T1, (SELECT A.* FROM Q_060 A WHERE COMPANYCD = #{COMPANYCD} AND PLANT = #{PLANT} AND Q_GUBUN = 'B') T2
		WHERE T1.Q_TYPE = T2.Q_TYPE(+)
		GROUP BY T1.RNO, T1.MGT1, T1.Q_TYPE, T1.Q_TYPE_UP, T1.TITLE1, T1.TITLE2, T2.Q_GUBUN
		) R
		ORDER BY RNO, Q_GUBUN
		) R2
	</select>
	
	<!-- 품질지수 > 협력사 품질관리 > 협력사품질(WORST10) 데이터 조회 -->
	<select id="selectParterWorstData" parameterType="json" resultType="json">
		SELECT ROWNUM RNO, R2.*, ROUND(RATIO_TO_REPORT(R2.PPM) OVER() * 100,2) AS PPM_RATIO
		FROM (
		SELECT R.G_VENDCD, R.BAL_QTY, R.K_QTY
		     , PREMIER_SYS.GETCMPYNMBYCMPYSN(R.G_VENDCD) G_VENDCD_NM
		     , ROUND(R.BAL_QTY/R.MENGE * 1000000,2) PPM 
		  FROM (
		SELECT T1.G_VENDCD, SUM(T1.BAL_QTY) BAL_QTY, SUM(T1.K_QTY) K_QTY, SUM(T2.MENGE) MENGE
		  FROM (
		SELECT PLANT, PARTNO, G_VENDCD, BAL_QTY, NVL(K_QTY,0) K_QTY
		     , (SELECT EMP_NO FROM COM_USER_INFO WHERE CMPY_SN = A.G_VENDCD AND ROWNUM = 1) LIFNR 
		  FROM Q_100 A
		 WHERE A.COMPANYCD = #{COMPANYCD}
		   AND A.PLANT = #{PLANTCD}
		<choose>
			<!-- LP -->
			<when test='TYPE == "A"'>
			AND B_GBN = '0000002548'
			</when>
			<!-- SKD -->
			<when test='TYPE == "B"'>
			AND B_GBN = '0000002133'
			</when>
			<!-- LP+SKD -->
			<otherwise>
			AND B_GBN in ('0000002133','0000002548')
			</otherwise>
		</choose>     
		   AND A.GUBUN <![CDATA[<>]]> '0000002209'
		   AND A.B_YMD LIKE REPLACE(#{YYYYMM},'-','')||'%'
		   AND ROWNUM <![CDATA[<]]> TO_NUMBER(#{WORST})+1
		) T1, (SELECT * FROM ERP_BASIC WHERE GUBUN = 'MM' AND SPMON = REPLACE(#{YYYYMM},'-','')) T2
		WHERE T1.PLANT = T2.PLANT
		  AND T1.LIFNR = T2.LIFNR
		  AND T1.PARTNO = T2.MATNR
		GROUP BY T1.G_VENDCD
		)R
		ORDER BY R.BAL_QTY/R.MENGE DESC
		)R2
	</select>
	<!-- 부적합 > QRQC 계획/실적 데이터 조회 -->
	<select id="selectQrqcPlantRsltData" parameterType="json" resultType="json">
		SELECT NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{PREV}||'%' THEN 1 ELSE 0 END ),0) PREV
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'%' THEN 1 ELSE 0 END ),0) TOT
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'01%' THEN 1 ELSE 0 END ),0) C01
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'02%' THEN 1 ELSE 0 END ),0) C02
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'03%' THEN 1 ELSE 0 END ),0) C03
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'04%' THEN 1 ELSE 0 END ),0) C04
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'05%' THEN 1 ELSE 0 END ),0) C05
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'06%' THEN 1 ELSE 0 END ),0) C06
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'07%' THEN 1 ELSE 0 END ),0) C07
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'08%' THEN 1 ELSE 0 END ),0) C08
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'09%' THEN 1 ELSE 0 END ),0) C09
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'10%' THEN 1 ELSE 0 END ),0) C10
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'11%' THEN 1 ELSE 0 END ),0) C11
		     , NVL(SUM(CASE WHEN REGISTER_NO LIKE 'B-'||#{YYYY}||'12%' THEN 1 ELSE 0 END ),0) C12
		  FROM (
		SELECT REGISTER_NO
		  FROM Q_200_QRQC_ACTN A, Q_100 B
		 WHERE A.REGISTER_NO = B.QQ_REGISTER_NO
		   AND B.PLANT = #{PLANT}
		 GROUP BY REGISTER_NO
		) T
		UNION ALL
		SELECT NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{PREV}||'%' THEN 1 ELSE 0 END ),0) PREV
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'%' THEN 1 ELSE 0 END ),0) TOT
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'01%' THEN 1 ELSE 0 END ),0) C01
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'02%' THEN 1 ELSE 0 END ),0) C02
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'03%' THEN 1 ELSE 0 END ),0) C03
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'04%' THEN 1 ELSE 0 END ),0) C04
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'05%' THEN 1 ELSE 0 END ),0) C05
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'06%' THEN 1 ELSE 0 END ),0) C06
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'07%' THEN 1 ELSE 0 END ),0) C07
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'08%' THEN 1 ELSE 0 END ),0) C08
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'09%' THEN 1 ELSE 0 END ),0) C09
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'10%' THEN 1 ELSE 0 END ),0) C10
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'11%' THEN 1 ELSE 0 END ),0) C11
		     , NVL(SUM(CASE WHEN T1.REGISTER_NO LIKE 'B-'||#{YYYY}||'12%' THEN 1 ELSE 0 END ),0) C12 
		FROM 
		(
		SELECT REGISTER_NO, COUNT(*) CNT
		  FROM Q_200_QRQC_ACTN A, Q_100 B
		 WHERE A.REGISTER_NO = B.QQ_REGISTER_NO
		   AND B.PLANT = #{PLANT}
		  GROUP BY REGISTER_NO) T1,
		(
		SELECT REGISTER_NO, COUNT(*) CNT
		  FROM Q_200_QRQC_ACTN A, Q_100 B
		 WHERE A.REGISTER_NO = B.QQ_REGISTER_NO
		   AND B.PLANT = #{PLANT}
		   AND ACTN_STATUS = '0000003273' AND CMPL_DATE IS NOT NULL
		 GROUP BY REGISTER_NO) T2
		WHERE T1.REGISTER_NO = T2.REGISTER_NO
		  AND T1.CNT = T2.CNT
	</select>
	<!-- 심사관리 > AUDIT 계획 데이터 조회 -->
	<select id="selectAuditPlanData" parameterType="json" resultType="json">
		SELECT NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{PREV}||'%' THEN 1 ELSE 0 END),0) PREV
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'%' THEN 1 ELSE 0 END),0) TOT
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'01%' THEN 1 ELSE 0 END),0) C01
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'02%' THEN 1 ELSE 0 END),0) C02
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'03%' THEN 1 ELSE 0 END),0) C03
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'04%' THEN 1 ELSE 0 END),0) C04
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'05%' THEN 1 ELSE 0 END),0) C05
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'06%' THEN 1 ELSE 0 END),0) C06
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'07%' THEN 1 ELSE 0 END),0) C07
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'08%' THEN 1 ELSE 0 END),0) C08
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'09%' THEN 1 ELSE 0 END),0) C09
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'10%' THEN 1 ELSE 0 END),0) C10
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'11%' THEN 1 ELSE 0 END),0) C11
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'12%' THEN 1 ELSE 0 END),0) C12
		  FROM G_811 A, Q_549_RESULT B 
		 WHERE A.S_NO = B.S_NO
		   and a.companycd = #{PLANT}
		UNION ALL
		SELECT NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{PREV}||'%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) PREV
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) TOT
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'01%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C01
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'02%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C02
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'03%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C03
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'04%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C04
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'05%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C05
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'06%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C06
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'07%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C07  
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'08%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C08
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'09%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C09
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'10%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C10
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'11%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C11
		     , NVL(SUM(CASE WHEN B.CHK_DATE LIKE #{YYYY}||'12%' AND PREMIER_SYS.GET_SIGNTYPECD('QMS_FNDM_MSRS',a.s_no||a.chasu) = 'C' THEN 1 ELSE 0 END),0) C12                                                                                                
		  FROM G_811 A, Q_549_RESULT B 
		 WHERE A.S_NO = B.S_NO
		   and a.companycd = #{PLANT}
	</select>
	<!-- 협력사 품질현황(협력사추이) 데이터 조회 -->
	<select id="selectParterTrendData" parameterType="json" resultType="json">
		select SUM(CASE WHEN YY = #{P_PREV} THEN (G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12 ELSE 0 END) P_PREV
		     , SUM(CASE WHEN YY = #{PREV} THEN (G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12 ELSE 0 END) PREV
		     , SUM(CASE WHEN YY = #{YYYY} THEN (G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12)/12 ELSE 0 END) TOT
		     , SUM(CASE WHEN YY = #{YYYY} THEN G01 ELSE 0 END) C01
		     , SUM(CASE WHEN YY = #{YYYY} THEN G02 ELSE 0 END) C02
		     , SUM(CASE WHEN YY = #{YYYY} THEN G03 ELSE 0 END) C03
		     , SUM(CASE WHEN YY = #{YYYY} THEN G04 ELSE 0 END) C04
		     , SUM(CASE WHEN YY = #{YYYY} THEN G05 ELSE 0 END) C05
		     , SUM(CASE WHEN YY = #{YYYY} THEN G06 ELSE 0 END) C06
		     , SUM(CASE WHEN YY = #{YYYY} THEN G07 ELSE 0 END) C07
		     , SUM(CASE WHEN YY = #{YYYY} THEN G08 ELSE 0 END) C08
		     , SUM(CASE WHEN YY = #{YYYY} THEN G09 ELSE 0 END) C09
		     , SUM(CASE WHEN YY = #{YYYY} THEN G10 ELSE 0 END) C10
		     , SUM(CASE WHEN YY = #{YYYY} THEN G11 ELSE 0 END) C11
		     , SUM(CASE WHEN YY = #{YYYY} THEN G12 ELSE 0 END) C12
		  from q_050 
		 where b_gbn = '0000003578'  
		   and b_dtl = #{TYPE2}  
		   and plantcd = #{PLANTCD}
		UNION ALL  
		SELECT SUM(CASE WHEN SPMON LIKE #{P_PREV}||'%' THEN MENGE ELSE 0 END) AS P_PREV
		     , SUM(CASE WHEN SPMON LIKE #{PREV}||'%' THEN MENGE ELSE 0 END) AS PREV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS TOT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS C01
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS C02
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS C03
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS C04
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS C05
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS C06
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS C07
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS C08
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS C09
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS C10
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS C11
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS C12    
		  FROM ERP_BASIC
		 WHERE GUBUN = 'MM'
		   AND PLANT = #{PLANTCD}
		<if test="G_VENDCD != null and G_VENDCD != ''">
		   AND LIFNR = (SELECT EMP_NO FROM PREMIER_SYS.COM_USER_INFO WHERE CMPY_SN = #{G_VENDCD} AND ROWNUM = 1)
		</if>
		UNION ALL
		SELECT NVL(SUM(CASE WHEN B_YMD LIKE #{P_PREV}||'%' THEN BAL_QTY ELSE 0 END) ,0) AS P_PREV
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{PREV}||'%' THEN BAL_QTY ELSE 0 END) ,0) AS PREV
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END) ,0) AS TOT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END) ,0) AS C12
		  FROM Q_100
		 WHERE COMPANYCD = #{COMPANYCD}
		   AND PLANT = #{PLANTCD}
		<choose>
			<!-- 부적합 -->
			<when test='TYPE2 == "0000003584"'>
			AND GUBUN <![CDATA[<>]]> '0000002209'
			</when>
			<!-- 수입검사 -->
			<otherwise>
			AND GUBUN = '0000002209'
			</otherwise>
		</choose>
		<choose>
			<!-- LP -->
			<when test='TYPE == "A"'>
			AND B_GBN = '0000002548'
			</when>
			<!-- SKD -->
			<when test='TYPE == "B"'>
			AND B_GBN = '0000002133'
			</when>
			<!-- LP+SKD -->
			<otherwise>
			AND B_GBN in ('0000002133','0000002548')
			</otherwise>
		</choose>
		<if test="G_VENDCD != null and G_VENDCD != ''">
			AND G_VENDCD = #{G_VENDCD}
		</if>
		   
	</select>
	<!-- 품질관리 사업실적 > 종합실적 데이터 조회 -->
	<select id="selectTotalPerformanceData" parameterType="json" resultType="json">
		SELECT 0 PREV, 0 JAN, 0 FEB, 0 MAR, 0 APR, 0 MAY, 0 JUN, 0 JUL, 0 AUG, 0 SEP, 0 OCT, 0 NOV, 0 DEC, 0 TOT FROM DUAL
		UNION ALL
		SELECT 0 PREV, 0 JAN, 0 FEB, 0 MAR, 0 APR, 0 MAY, 0 JUN, 0 JUL, 0 AUG, 0 SEP, 0 OCT, 0 NOV, 0 DEC, 0 TOT FROM DUAL
		UNION ALL
		SELECT NVL(T1.PREV,0) PREV
		     , NVL(T1.JAN,0) JAN, NVL(T1.FEB,0) FEB, NVL(T1.MAR,0) MAR, NVL(T1.APR,0) APR, NVL(T1.MAY,0) MAY, NVL(T1.JUN,0) JUN, NVL(T1.JUL,0) JUL, NVL(T1.AUG,0) AUG, NVL(T1.SEP,0) SEP, NVL(T1.OCT,0) OCT, NVL(T1.NOV,0) NOV, NVL(T1.DEC,0) DEC
		     , NVL((T1.JAN + T1.FEB + T1.MAR + T1.APR + T1.MAY + T1.JUN + T1.JUL + T1.AUG + T1.SEP + T1.OCT + T1.NOV + T1.DEC) / 12,0) TOT
		  FROM (
		SELECT SUM(CASE WHEN YY = #{P_YYYY} THEN (G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12) / 12 ELSE 0 END) PREV
		     , SUM(CASE WHEN YY = #{YYYY} THEN G01 ELSE 0 END) JAN
		     , SUM(CASE WHEN YY = #{YYYY} THEN G02 ELSE 0 END) FEB
		     , SUM(CASE WHEN YY = #{YYYY} THEN G03 ELSE 0 END) MAR
		     , SUM(CASE WHEN YY = #{YYYY} THEN G04 ELSE 0 END) APR
		     , SUM(CASE WHEN YY = #{YYYY} THEN G05 ELSE 0 END) MAY
		     , SUM(CASE WHEN YY = #{YYYY} THEN G06 ELSE 0 END) JUN
		     , SUM(CASE WHEN YY = #{YYYY} THEN G07 ELSE 0 END) JUL
		     , SUM(CASE WHEN YY = #{YYYY} THEN G08 ELSE 0 END) AUG
		     , SUM(CASE WHEN YY = #{YYYY} THEN G09 ELSE 0 END) SEP
		     , SUM(CASE WHEN YY = #{YYYY} THEN G10 ELSE 0 END) OCT
		     , SUM(CASE WHEN YY = #{YYYY} THEN G11 ELSE 0 END) NOV
		     , SUM(CASE WHEN YY = #{YYYY} THEN G12 ELSE 0 END) DEC
		  FROM Q_050
		 WHERE COMPANYCD = #{COMPANYCD}
		   AND PLANTCD = #{PLANT}
		   AND B_GBN = '0000003573'
		) T1
		UNION ALL
		SELECT CASE WHEN T2.PREV<![CDATA[>]]>0 AND T1.PREV<![CDATA[>]]>0 THEN ROUND(T2.PREV / T1.PREV * 1000000,1) ELSE 0 END PREV
		     , CASE WHEN T2.JAN<![CDATA[>]]>0 AND T1.JAN<![CDATA[>]]>0 THEN ROUND(T2.JAN / T1.JAN * 1000000,1) ELSE 0 END JAN
		     , CASE WHEN T2.FEB<![CDATA[>]]>0 AND T1.FEB<![CDATA[>]]>0 THEN ROUND(T2.FEB / T1.FEB * 1000000,1) ELSE 0 END FEB
		     , CASE WHEN T2.MAR<![CDATA[>]]>0 AND T1.MAR<![CDATA[>]]>0 THEN ROUND(T2.MAR / T1.MAR * 1000000,1) ELSE 0 END MAR
		     , CASE WHEN T2.APR<![CDATA[>]]>0 AND T1.APR<![CDATA[>]]>0 THEN ROUND(T2.APR / T1.APR * 1000000,1) ELSE 0 END APR
		     , CASE WHEN T2.MAY<![CDATA[>]]>0 AND T1.MAY<![CDATA[>]]>0 THEN ROUND(T2.MAY / T1.MAY * 1000000,1) ELSE 0 END MAY
		     , CASE WHEN T2.JUN<![CDATA[>]]>0 AND T1.JUN<![CDATA[>]]>0 THEN ROUND(T2.JUN / T1.JUN * 1000000,1) ELSE 0 END JUN
		     , CASE WHEN T2.JUL<![CDATA[>]]>0 AND T1.JUL<![CDATA[>]]>0 THEN ROUND(T2.JUL / T1.JUL * 1000000,1) ELSE 0 END JUL
		     , CASE WHEN T2.AUG<![CDATA[>]]>0 AND T1.AUG<![CDATA[>]]>0 THEN ROUND(T2.AUG / T1.AUG * 1000000,1) ELSE 0 END AUG
		     , CASE WHEN T2.SEP<![CDATA[>]]>0 AND T1.SEP<![CDATA[>]]>0 THEN ROUND(T2.SEP / T1.SEP * 1000000,1) ELSE 0 END SEP
		     , CASE WHEN T2.OCT<![CDATA[>]]>0 AND T1.OCT<![CDATA[>]]>0 THEN ROUND(T2.OCT / T1.OCT * 1000000,1) ELSE 0 END OCT
		     , CASE WHEN T2.NOV<![CDATA[>]]>0 AND T1.NOV<![CDATA[>]]>0 THEN ROUND(T2.NOV / T1.NOV * 1000000,1) ELSE 0 END NOV
		     , CASE WHEN T2.DEC<![CDATA[>]]>0 AND T1.DEC<![CDATA[>]]>0 THEN ROUND(T2.DEC / T1.DEC * 1000000,1) ELSE 0 END DEC
		     , CASE WHEN T2.TOT<![CDATA[>]]>0 AND T1.TOT<![CDATA[>]]>0 THEN ROUND(T2.TOT / T1.TOT * 1000000,1) ELSE 0 END TOT
		  FROM 
		(
		SELECT SUM(CASE WHEN SPMON LIKE #{P_YYYY}||'%' THEN MENGE ELSE 0 END) AS PREV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS TOT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS JAN
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS FEB
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS MAR
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS APR
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS MAY
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS JUN
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS JUL
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS AUG
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS SEP
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS OCT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS NOV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS DEC
		     , PLANT
		  FROM ERP_BASIC
		 WHERE PLANT = #{PLANT}
		   AND GUBUN = 'SD'
		 GROUP BY PLANT) T1
		,(
		SELECT SUM(CASE WHEN B_YMD LIKE #{P_YYYY}||'%' THEN B_QTY ELSE 0 END) AS PREV
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN B_QTY ELSE 0 END) AS TOT
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN B_QTY ELSE 0 END) AS JAN
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN B_QTY ELSE 0 END) AS FEB
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN B_QTY ELSE 0 END) AS MAR
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN B_QTY ELSE 0 END) AS APR
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN B_QTY ELSE 0 END) AS MAY
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN B_QTY ELSE 0 END) AS JUN
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN B_QTY ELSE 0 END) AS JUL
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN B_QTY ELSE 0 END) AS AUG
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN B_QTY ELSE 0 END) AS SEP
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN B_QTY ELSE 0 END) AS OCT
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN B_QTY ELSE 0 END) AS NOV
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN B_QTY ELSE 0 END) AS DEC
		     , PLANT
		  FROM Q_100 A
		 WHERE A.COMPANYCD = #{COMPANYCD}
		   AND A.PLANT = #{PLANT}
		   AND A.B_GBN IN ('0000002128','0000002131') 
		 GROUP BY PLANT)T2
		WHERE T1.PLANT = T2.PLANT(+)  
		UNION ALL
		SELECT NVL(T1.PREV,0) PREV
		     , NVL(T1.JAN,0) JAN, NVL(T1.FEB,0) FEB, NVL(T1.MAR,0) MAR, NVL(T1.APR,0) APR, NVL(T1.MAY,0) MAY, NVL(T1.JUN,0) JUN, NVL(T1.JUL,0) JUL, NVL(T1.AUG,0) AUG, NVL(T1.SEP,0) SEP, NVL(T1.OCT,0) OCT, NVL(T1.NOV,0) NOV, NVL(T1.DEC,0) DEC
		     , NVL((T1.JAN + T1.FEB + T1.MAR + T1.APR + T1.MAY + T1.JUN + T1.JUL + T1.AUG + T1.SEP + T1.OCT + T1.NOV + T1.DEC) / 12,0) TOT
		  FROM (
		SELECT SUM(CASE WHEN YY = #{P_YYYY} THEN (G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12) / 12 ELSE 0 END) PREV
		     , SUM(CASE WHEN YY = #{YYYY} THEN G01 ELSE 0 END) JAN
		     , SUM(CASE WHEN YY = #{YYYY} THEN G02 ELSE 0 END) FEB
		     , SUM(CASE WHEN YY = #{YYYY} THEN G03 ELSE 0 END) MAR
		     , SUM(CASE WHEN YY = #{YYYY} THEN G04 ELSE 0 END) APR
		     , SUM(CASE WHEN YY = #{YYYY} THEN G05 ELSE 0 END) MAY
		     , SUM(CASE WHEN YY = #{YYYY} THEN G06 ELSE 0 END) JUN
		     , SUM(CASE WHEN YY = #{YYYY} THEN G07 ELSE 0 END) JUL
		     , SUM(CASE WHEN YY = #{YYYY} THEN G08 ELSE 0 END) AUG
		     , SUM(CASE WHEN YY = #{YYYY} THEN G09 ELSE 0 END) SEP
		     , SUM(CASE WHEN YY = #{YYYY} THEN G10 ELSE 0 END) OCT
		     , SUM(CASE WHEN YY = #{YYYY} THEN G11 ELSE 0 END) NOV
		     , SUM(CASE WHEN YY = #{YYYY} THEN G12 ELSE 0 END) DEC
		  FROM Q_050
		 WHERE COMPANYCD = #{COMPANYCD}
		   AND PLANTCD = #{PLANT}
		   AND B_GBN = '0000003574'
		) T1 
		UNION ALL
		SELECT CASE WHEN T2.PREV<![CDATA[>]]>0 AND T1.PREV<![CDATA[>]]>0 THEN ROUND(T2.PREV / T1.PREV * 1000000,1) ELSE 0 END PREV
		     , CASE WHEN T2.JAN<![CDATA[>]]>0 AND T1.JAN<![CDATA[>]]>0 THEN ROUND(T2.JAN / T1.JAN * 1000000,1) ELSE 0 END JAN
		     , CASE WHEN T2.FEB<![CDATA[>]]>0 AND T1.FEB<![CDATA[>]]>0 THEN ROUND(T2.FEB / T1.FEB * 1000000,1) ELSE 0 END FEB
		     , CASE WHEN T2.MAR<![CDATA[>]]>0 AND T1.MAR<![CDATA[>]]>0 THEN ROUND(T2.MAR / T1.MAR * 1000000,1) ELSE 0 END MAR
		     , CASE WHEN T2.APR<![CDATA[>]]>0 AND T1.APR<![CDATA[>]]>0 THEN ROUND(T2.APR / T1.APR * 1000000,1) ELSE 0 END APR
		     , CASE WHEN T2.MAY<![CDATA[>]]>0 AND T1.MAY<![CDATA[>]]>0 THEN ROUND(T2.MAY / T1.MAY * 1000000,1) ELSE 0 END MAY
		     , CASE WHEN T2.JUN<![CDATA[>]]>0 AND T1.JUN<![CDATA[>]]>0 THEN ROUND(T2.JUN / T1.JUN * 1000000,1) ELSE 0 END JUN
		     , CASE WHEN T2.JUL<![CDATA[>]]>0 AND T1.JUL<![CDATA[>]]>0 THEN ROUND(T2.JUL / T1.JUL * 1000000,1) ELSE 0 END JUL
		     , CASE WHEN T2.AUG<![CDATA[>]]>0 AND T1.AUG<![CDATA[>]]>0 THEN ROUND(T2.AUG / T1.AUG * 1000000,1) ELSE 0 END AUG
		     , CASE WHEN T2.SEP<![CDATA[>]]>0 AND T1.SEP<![CDATA[>]]>0 THEN ROUND(T2.SEP / T1.SEP * 1000000,1) ELSE 0 END SEP
		     , CASE WHEN T2.OCT<![CDATA[>]]>0 AND T1.OCT<![CDATA[>]]>0 THEN ROUND(T2.OCT / T1.OCT * 1000000,1) ELSE 0 END OCT
		     , CASE WHEN T2.NOV<![CDATA[>]]>0 AND T1.NOV<![CDATA[>]]>0 THEN ROUND(T2.NOV / T1.NOV * 1000000,1) ELSE 0 END NOV
		     , CASE WHEN T2.DEC<![CDATA[>]]>0 AND T1.DEC<![CDATA[>]]>0 THEN ROUND(T2.DEC / T1.DEC * 1000000,1) ELSE 0 END DEC
		     , CASE WHEN T2.TOT<![CDATA[>]]>0 AND T1.TOT<![CDATA[>]]>0 THEN ROUND(T2.TOT / T1.TOT * 1000000,1) ELSE 0 END TOT
		  FROM 
		(
		SELECT SUM(CASE WHEN SPMON LIKE #{P_YYYY}||'%' THEN MENGE ELSE 0 END) AS PREV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS TOT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS JAN
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS FEB
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS MAR
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS APR
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS MAY
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS JUN
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS JUL
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS AUG
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS SEP
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS OCT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS NOV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS DEC
		     , PLANT
		  FROM ERP_BASIC
		 WHERE PLANT = #{PLANT}
		   AND GUBUN = 'PP'
		 GROUP BY PLANT) T1
		,(
		SELECT SUM(CASE WHEN B_YMD LIKE #{P_YYYY}||'%' THEN B_QTY ELSE 0 END) AS PREV
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN B_QTY ELSE 0 END) AS TOT
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN B_QTY ELSE 0 END) AS JAN
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN B_QTY ELSE 0 END) AS FEB
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN B_QTY ELSE 0 END) AS MAR
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN B_QTY ELSE 0 END) AS APR
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN B_QTY ELSE 0 END) AS MAY
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN B_QTY ELSE 0 END) AS JUN
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN B_QTY ELSE 0 END) AS JUL
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN B_QTY ELSE 0 END) AS AUG
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN B_QTY ELSE 0 END) AS SEP
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN B_QTY ELSE 0 END) AS OCT
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN B_QTY ELSE 0 END) AS NOV
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN B_QTY ELSE 0 END) AS DEC
		     , PLANT
		  FROM Q_100 A
		 WHERE A.COMPANYCD = #{COMPANYCD}
		   AND A.PLANT = #{PLANT}
		   AND A.B_GBN = '0000002129'
		 GROUP BY PLANT)T2
		WHERE T1.PLANT = T2.PLANT(+)
		UNION ALL
		SELECT NVL(T1.PREV,0) PREV
		     , NVL(T1.JAN,0) JAN, NVL(T1.FEB,0) FEB, NVL(T1.MAR,0) MAR, NVL(T1.APR,0) APR, NVL(T1.MAY,0) MAY, NVL(T1.JUN,0) JUN, NVL(T1.JUL,0) JUL, NVL(T1.AUG,0) AUG, NVL(T1.SEP,0) SEP, NVL(T1.OCT,0) OCT, NVL(T1.NOV,0) NOV, NVL(T1.DEC,0) DEC
		     , NVL((T1.JAN + T1.FEB + T1.MAR + T1.APR + T1.MAY + T1.JUN + T1.JUL + T1.AUG + T1.SEP + T1.OCT + T1.NOV + T1.DEC) / 12,0) TOT
		  FROM (
		SELECT SUM(CASE WHEN YY = #{P_YYYY} THEN (G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12) / 12 ELSE 0 END) PREV
		     , SUM(CASE WHEN YY = #{YYYY} THEN G01 ELSE 0 END) JAN
		     , SUM(CASE WHEN YY = #{YYYY} THEN G02 ELSE 0 END) FEB
		     , SUM(CASE WHEN YY = #{YYYY} THEN G03 ELSE 0 END) MAR
		     , SUM(CASE WHEN YY = #{YYYY} THEN G04 ELSE 0 END) APR
		     , SUM(CASE WHEN YY = #{YYYY} THEN G05 ELSE 0 END) MAY
		     , SUM(CASE WHEN YY = #{YYYY} THEN G06 ELSE 0 END) JUN
		     , SUM(CASE WHEN YY = #{YYYY} THEN G07 ELSE 0 END) JUL
		     , SUM(CASE WHEN YY = #{YYYY} THEN G08 ELSE 0 END) AUG
		     , SUM(CASE WHEN YY = #{YYYY} THEN G09 ELSE 0 END) SEP
		     , SUM(CASE WHEN YY = #{YYYY} THEN G10 ELSE 0 END) OCT
		     , SUM(CASE WHEN YY = #{YYYY} THEN G11 ELSE 0 END) NOV
		     , SUM(CASE WHEN YY = #{YYYY} THEN G12 ELSE 0 END) DEC
		  FROM Q_050
		 WHERE COMPANYCD = #{COMPANYCD}
		   AND PLANTCD = #{PLANT}
		   AND B_GBN = '0000003575'
		) T1
		UNION ALL
		SELECT CASE WHEN T2.PREV<![CDATA[>]]>0 AND T1.PREV<![CDATA[>]]>0 THEN ROUND(T2.PREV / T1.PREV * 1000000,1) ELSE 0 END PREV
		     , CASE WHEN T2.JAN<![CDATA[>]]>0 AND T1.JAN<![CDATA[>]]>0 THEN ROUND(T2.JAN / T1.JAN * 1000000,1) ELSE 0 END JAN
		     , CASE WHEN T2.FEB<![CDATA[>]]>0 AND T1.FEB<![CDATA[>]]>0 THEN ROUND(T2.FEB / T1.FEB * 1000000,1) ELSE 0 END FEB
		     , CASE WHEN T2.MAR<![CDATA[>]]>0 AND T1.MAR<![CDATA[>]]>0 THEN ROUND(T2.MAR / T1.MAR * 1000000,1) ELSE 0 END MAR
		     , CASE WHEN T2.APR<![CDATA[>]]>0 AND T1.APR<![CDATA[>]]>0 THEN ROUND(T2.APR / T1.APR * 1000000,1) ELSE 0 END APR
		     , CASE WHEN T2.MAY<![CDATA[>]]>0 AND T1.MAY<![CDATA[>]]>0 THEN ROUND(T2.MAY / T1.MAY * 1000000,1) ELSE 0 END MAY
		     , CASE WHEN T2.JUN<![CDATA[>]]>0 AND T1.JUN<![CDATA[>]]>0 THEN ROUND(T2.JUN / T1.JUN * 1000000,1) ELSE 0 END JUN
		     , CASE WHEN T2.JUL<![CDATA[>]]>0 AND T1.JUL<![CDATA[>]]>0 THEN ROUND(T2.JUL / T1.JUL * 1000000,1) ELSE 0 END JUL
		     , CASE WHEN T2.AUG<![CDATA[>]]>0 AND T1.AUG<![CDATA[>]]>0 THEN ROUND(T2.AUG / T1.AUG * 1000000,1) ELSE 0 END AUG
		     , CASE WHEN T2.SEP<![CDATA[>]]>0 AND T1.SEP<![CDATA[>]]>0 THEN ROUND(T2.SEP / T1.SEP * 1000000,1) ELSE 0 END SEP
		     , CASE WHEN T2.OCT<![CDATA[>]]>0 AND T1.OCT<![CDATA[>]]>0 THEN ROUND(T2.OCT / T1.OCT * 1000000,1) ELSE 0 END OCT
		     , CASE WHEN T2.NOV<![CDATA[>]]>0 AND T1.NOV<![CDATA[>]]>0 THEN ROUND(T2.NOV / T1.NOV * 1000000,1) ELSE 0 END NOV
		     , CASE WHEN T2.DEC<![CDATA[>]]>0 AND T1.DEC<![CDATA[>]]>0 THEN ROUND(T2.DEC / T1.DEC * 1000000,1) ELSE 0 END DEC
		     , CASE WHEN T2.TOT<![CDATA[>]]>0 AND T1.TOT<![CDATA[>]]>0 THEN ROUND(T2.TOT / T1.TOT * 1000000,1) ELSE 0 END TOT
		  FROM 
		(
		SELECT SUM(CASE WHEN SPMON LIKE #{P_YYYY}||'%' THEN MENGE ELSE 0 END) AS PREV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS TOT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS JAN
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS FEB
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS MAR
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS APR
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS MAY
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS JUN
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS JUL
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS AUG
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS SEP
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS OCT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS NOV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS DEC
		     , PLANT
		  FROM ERP_BASIC
		 WHERE PLANT = #{PLANT}
		   AND GUBUN = 'MM'
		 GROUP BY PLANT) T1
		,(
		SELECT SUM(CASE WHEN B_YMD LIKE #{P_YYYY}||'%' THEN BAL_QTY ELSE 0 END) AS PREV
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END) AS TOT
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END) AS JAN
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END) AS FEB
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END) AS MAR
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END) AS APR
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END) AS MAY
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END) AS JUN
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END) AS JUL
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END) AS AUG
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END) AS SEP
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END) AS OCT
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END) AS NOV
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END) AS DEC
		     , PLANT
		  FROM Q_100 A
		 WHERE A.COMPANYCD = #{COMPANYCD}
		   AND A.PLANT = #{PLANT}
		   AND A.B_GBN = '0000002548'   
		   AND A.GUBUN <![CDATA[<>]]> '0000002209'  
		 GROUP BY PLANT)T2
		WHERE T1.PLANT = T2.PLANT(+)
				
	</select>
	<!-- 전년도+당해월별 부적합 데이터 조회 -->
	<select id="selectNonQtyData" parameterType="json" resultType="json">
		SELECT SUM(CASE WHEN B_YMD LIKE #{P_YYYY}||'%' THEN ${TYPE2} ELSE 0 END) AS PREV
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%'   THEN ${TYPE2} ELSE 0 END) AS TOT
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN ${TYPE2} ELSE 0 END) AS JAN
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN ${TYPE2} ELSE 0 END) AS FEB
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN ${TYPE2} ELSE 0 END) AS MAR
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN ${TYPE2} ELSE 0 END) AS APR
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN ${TYPE2} ELSE 0 END) AS MAY
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN ${TYPE2} ELSE 0 END) AS JUN
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN ${TYPE2} ELSE 0 END) AS JUL
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN ${TYPE2} ELSE 0 END) AS AUG
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN ${TYPE2} ELSE 0 END) AS SEP
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN ${TYPE2} ELSE 0 END) AS OCT
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN ${TYPE2} ELSE 0 END) AS NOV
		     , SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN ${TYPE2} ELSE 0 END) AS DEC
		  FROM Q_100 A
		 WHERE A.COMPANYCD = #{COMPANYCD} 
		   AND A.PLANT = #{PLANT}
		<choose>
			<when test='TYPE == "A"'>
			AND A.B_GBN IN ('0000002128','0000002131')
			</when>
			<when test='TYPE == "B"'>
			AND B_GBN = '0000002129' 
			</when>
			<otherwise>
			AND B_GBN = '0000002548'	 
		    AND GUBUN <![CDATA[<>]]> '0000002209'
			</otherwise>
		</choose>
	</select>
	<!-- 전년도+당해월별 ERP 데이터 조회 -->
	<select id="selectErpQtyData" parameterType="json" resultType="json">
		SELECT SUM(CASE WHEN SPMON LIKE #{P_YYYY}||'%' THEN MENGE ELSE 0 END) AS PREV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'%'   THEN MENGE ELSE 0 END) AS TOT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS JAN
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS FEB
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS MAR
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS APR
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS MAY
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS JUN
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS JUL
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS AUG
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS SEP
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS OCT
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS NOV
		     , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS DEC
		  FROM ERP_BASIC
		 WHERE PLANT = #{PLANT}
		 <choose>
			<when test='TYPE == "A"'>
			AND GUBUN = 'SD'
			</when>
			<when test='TYPE == "B"'>
			AND GUBUN = 'PP' 
			</when>
			<otherwise>
			AND GUBUN = 'MM'
			</otherwise>
		</choose>
	</select>
	
	<!-- 년도 본부별 실적 조회 -->
	<select id="selectYearPerformanceByHQ" parameterType="json" resultType="json">
		SELECT CASE WHEN T1.C <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C/MENGE*1000000) ELSE 0 END C
		     , CASE WHEN T1.F <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.F/MENGE*1000000) ELSE 0 END F
		     , CASE WHEN T1.P <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.P/MENGE*1000000) ELSE 0 END P
		     , CASE WHEN T1.T <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.T/MENGE*1000000) ELSE 0 END T
		  FROM (
		        SELECT
		        <choose>
					<when test='TYPE != null and TYPE == "0000003575"'>
					   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' AND PROTYPE IN ('0000003449') THEN BAL_QTY ELSE 0 END) ,0) AS C
		             , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' AND PROTYPE IN ('0000003450','0000003451','0000003452','0000003453','0000003454') THEN BAL_QTY ELSE 0 END) ,0) AS F
		             , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' AND PROTYPE IN ('0000003455') THEN BAL_QTY ELSE 0 END) ,0) AS P
		             , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END) ,0) AS T
					</when>
					<otherwise>
					   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' AND PROTYPE IN ('0000003449') THEN B_QTY ELSE 0 END) ,0) AS C
		             , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' AND PROTYPE IN ('0000003450','0000003451','0000003452','0000003453','0000003454') THEN B_QTY ELSE 0 END) ,0) AS F
		             , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' AND PROTYPE IN ('0000003455') THEN B_QTY ELSE 0 END) ,0) AS P
		             , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN B_QTY ELSE 0 END) ,0) AS T
					</otherwise>
				</choose>
		          FROM Q_100 a
		         WHERE A.COMPANYCD = #{COMPANYCD} 
		         <choose>
					<when test='HQ != null and HQ == "C"'>
						<choose>
							<when test="PLANT != null and PLANT != ''">
				   AND A.PLANT = #{PLANT}
							</when>
							<otherwise>
				   AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
							</otherwise>
						</choose>
					</when>
					<when test='HQ != null and HQ == "F"'>
						<choose>
							<when test="PLANT != null and PLANT != ''">
				   AND A.PLANT = #{PLANT}
							</when>
							<otherwise>
				   AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
							</otherwise>
						</choose>
					</when>
					<when test='HQ != null and HQ == "P"'>
						<choose>
							<when test="PLANT != null and PLANT != ''">
				   AND A.PLANT = #{PLANT}
							</when>
							<otherwise>
				   AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
							</otherwise>
						</choose>
					</when>
				</choose>
		        <choose>
					<when test='TYPE != null and TYPE == "0000003573"'>
				   AND B_GBN IN ('0000002128','0000002131')
					</when>
					<when test='TYPE != null and TYPE == "0000003574"'>
				   AND B_GBN = '0000002129' 
					</when>
					<when test='TYPE != null and TYPE == "0000003575"'>
				   AND B_GBN = '0000002548'	 
				   AND GUBUN <![CDATA[<>]]> '0000002209'
					</when>
				</choose>
		  ) T1,(
		        SELECT SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS MENGE
		          FROM ERP_BASIC A
		         WHERE 1=1
		         <choose>
					<when test='HQ != null and HQ == "C"'>
						<choose>
							<when test="PLANT != null and PLANT != ''">
				AND A.PLANT = #{PLANT}
							</when>
							<otherwise>
				AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
							</otherwise>
						</choose>
					</when>
					<when test='HQ != null and HQ == "F"'>
						<choose>
							<when test="PLANT != null and PLANT != ''">
				AND A.PLANT = #{PLANT}
							</when>
							<otherwise>
				AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
							</otherwise>
						</choose>
					</when>
					<when test='HQ != null and HQ == "P"'>
						<choose>
							<when test="PLANT != null and PLANT != ''">
				AND A.PLANT = #{PLANT}
							</when>
							<otherwise>
				AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
							</otherwise>
						</choose>
					</when>
				</choose>
		        <choose>
					<when test='TYPE != null and TYPE == "0000003573"'>
			    AND GUBUN = 'SD'
					</when>
					<when test='TYPE != null and TYPE == "0000003574"'>
			    AND GUBUN = 'PP' 
					</when>
					<when test='TYPE != null and TYPE == "0000003575"'>
			    AND GUBUN = 'MM' 
					</when>
			 	</choose>
		  ) T2
	</select>
	<!-- 본부별 공장 목록 조회 -->
	<select id="selectPlantListByHQ" parameterType="json" resultType="json">
		SELECT T1.* FROM (
		SELECT PLANT_CD "value", PLANT_NM "content" 
		  FROM COM_PLANT_INFO 
		 WHERE MGT1 = #{HQ} 
		 ORDER BY PLANT_CD) T1
	</select>
	<!-- 불량률추이(고객,공정,외주) 그리드 조회 -->
	<select id="selectStatusFaultyRateList" parameterType="json" resultType="json">
		SELECT '합계' TITLE2 , RTRIM(TO_CHAR(ROUND(T2.TGT,2),'FM999999999999990.99'),'.') TGT
		     , CASE WHEN T1.TOT <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.TOT/MENGE*1000000) ELSE 0 END TOT
		     , CASE WHEN T1.C01 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C01/MENGE01*1000000) ELSE 0 END C01
		     , CASE WHEN T1.C02 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C02/MENGE02*1000000) ELSE 0 END C02
		     , CASE WHEN T1.C03 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C03/MENGE03*1000000) ELSE 0 END C03
		     , CASE WHEN T1.C04 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C04/MENGE04*1000000) ELSE 0 END C04
		     , CASE WHEN T1.C05 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C05/MENGE05*1000000) ELSE 0 END C05
		     , CASE WHEN T1.C06 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C06/MENGE06*1000000) ELSE 0 END C06
		     , CASE WHEN T1.C07 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C07/MENGE07*1000000) ELSE 0 END C07
		     , CASE WHEN T1.C08 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C08/MENGE08*1000000) ELSE 0 END C08
		     , CASE WHEN T1.C09 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C09/MENGE09*1000000) ELSE 0 END C09
		     , CASE WHEN T1.C10 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C10/MENGE10*1000000) ELSE 0 END C10
		     , CASE WHEN T1.C11 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C11/MENGE11*1000000) ELSE 0 END C11
		     , CASE WHEN T1.C12 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C12/MENGE12*1000000) ELSE 0 END C12
		     , T1.CNT  
		FROM (
		<!-- 합계 -->
		SELECT 
		<choose>
			<when test='TYPE != null and TYPE == "0000003575"'>
			   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END) ,0) AS TOT
			 , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END) ,0) AS C12
			</when>
			<otherwise>
			   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN B_QTY ELSE 0 END) ,0) AS TOT
			 , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN B_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN B_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN B_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN B_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN B_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN B_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN B_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN B_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN B_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN B_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN B_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN B_QTY ELSE 0 END) ,0) AS C12
			</otherwise>
		</choose>
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN 1 ELSE 0 END),0) CNT   
		  FROM Q_100 a
		 WHERE A.COMPANYCD = #{COMPANYCD} 
		<choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
					</otherwise>
				</choose>
			</when>
		</choose>
		<choose>
			<when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131')
			</when>
			<when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			</when>
			<when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			</when>
		</choose>
		) T1, 
		(SELECT NVL(AVG(R.TGT),0) TGT FROM (
			SELECT PLANTCD, NVL((SUM(G01) + SUM(G02) + SUM(G03) + SUM(G04) + SUM(G05) + SUM(G06) + SUM(G07) + SUM(G08) + SUM(G09) + SUM(G10) + SUM(G11) + SUM(G12))/12, 0) AS TGT 
			  from q_050 A
			 WHERE COMPANYCD = #{COMPANYCD} AND YY = #{YYYY} AND B_GBN = #{TYPE}
			 <choose>
				<when test='HQ != null and HQ == "C"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
						</otherwise>
					</choose>
				</when>
				<when test='HQ != null and HQ == "F"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
						</otherwise>
					</choose>
				</when>
				<when test='HQ != null and HQ == "P"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
						</otherwise>
					</choose>
				</when>
			</choose>
			GROUP BY PLANTCD ) R
		) T2,
		(SELECT SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS MENGE
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS MENGE01
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS MENGE02
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS MENGE03
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS MENGE04
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS MENGE05
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS MENGE06
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS MENGE07
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS MENGE08
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS MENGE09
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS MENGE10
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS MENGE11
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS MENGE12
		   FROM ERP_BASIC A
		  WHERE 1=1
		  <choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
					</otherwise>
				</choose>
			</when>
		  </choose>
		  <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		    AND GUBUN = 'SD'
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		    AND GUBUN = 'PP' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		    AND GUBUN = 'MM' 
			 </when>
		  </choose>
		)T3
		UNION ALL
		<!-- 샤시 -->
		SELECT '샤시' TITLE2 , RTRIM(TO_CHAR(ROUND(T2.TGT,2),'FM999999999999990.99'),'.') TGT
		     , CASE WHEN T1.TOT <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.TOT/MENGE*1000000) ELSE 0 END TOT
		     , CASE WHEN T1.C01 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C01/MENGE01*1000000) ELSE 0 END C01
		     , CASE WHEN T1.C02 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C02/MENGE02*1000000) ELSE 0 END C02
		     , CASE WHEN T1.C03 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C03/MENGE03*1000000) ELSE 0 END C03
		     , CASE WHEN T1.C04 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C04/MENGE04*1000000) ELSE 0 END C04
		     , CASE WHEN T1.C05 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C05/MENGE05*1000000) ELSE 0 END C05
		     , CASE WHEN T1.C06 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C06/MENGE06*1000000) ELSE 0 END C06
		     , CASE WHEN T1.C07 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C07/MENGE07*1000000) ELSE 0 END C07
		     , CASE WHEN T1.C08 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C08/MENGE08*1000000) ELSE 0 END C08
		     , CASE WHEN T1.C09 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C09/MENGE09*1000000) ELSE 0 END C09
		     , CASE WHEN T1.C10 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C10/MENGE10*1000000) ELSE 0 END C10
		     , CASE WHEN T1.C11 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C11/MENGE11*1000000) ELSE 0 END C11
		     , CASE WHEN T1.C12 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C12/MENGE12*1000000) ELSE 0 END C12
		     , T1.CNT
		FROM (
		SELECT 
		<choose>
			<when test='TYPE != null and TYPE == "0000003575"'>
			   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END) ,0) AS TOT
			 , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END) ,0) AS C12
			</when>
			<otherwise>
			   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN B_QTY ELSE 0 END) ,0) AS TOT
			 , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN B_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN B_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN B_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN B_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN B_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN B_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN B_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN B_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN B_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN B_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN B_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN B_QTY ELSE 0 END) ,0) AS C12
			</otherwise>
		</choose>
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN 1 ELSE 0 END),0) CNT   
		  FROM Q_100 a
		 WHERE A.COMPANYCD = #{COMPANYCD} 
		<choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
					</otherwise>
				</choose>
			</when>
		</choose>  
		<choose>
			<when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131')
			</when>
			<when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			</when>
			<when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			</when>
		</choose>
		   AND PROTYPE = '0000003449'
		) T1, 
		(SELECT NVL(AVG(R.TGT),0) TGT FROM (
			SELECT PLANTCD, NVL((SUM(G01) + SUM(G02) + SUM(G03) + SUM(G04) + SUM(G05) + SUM(G06) + SUM(G07) + SUM(G08) + SUM(G09) + SUM(G10) + SUM(G11) + SUM(G12))/12, 0) AS TGT 
			  from q_050 A
			 WHERE COMPANYCD = #{COMPANYCD} AND YY = #{YYYY} AND B_GBN = #{TYPE} AND B_DTL = '0000003581'
			 <choose>
				<when test='HQ != null and HQ == "C"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
						</otherwise>
					</choose>
				</when>
				<when test='HQ != null and HQ == "F"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
						</otherwise>
					</choose>
				</when>
				<when test='HQ != null and HQ == "P"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
						</otherwise>
					</choose>
				</when>
			</choose>
			GROUP BY PLANTCD ) R
		) T2,
		(SELECT SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS MENGE
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS MENGE01
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS MENGE02
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS MENGE03
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS MENGE04
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS MENGE05
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS MENGE06
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS MENGE07
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS MENGE08
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS MENGE09
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS MENGE10
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS MENGE11
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS MENGE12
		   FROM ERP_BASIC A
		  WHERE 1=1
		  <choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
					</otherwise>
				</choose>
			</when>
		  </choose>
		  <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		    AND GUBUN = 'SD'
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		    AND GUBUN = 'PP' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		    AND GUBUN = 'MM' 
			 </when>
		  </choose>
		)T3
		UNION ALL
		<!-- 연료 -->
		SELECT '연료' TITLE2 , RTRIM(TO_CHAR(ROUND(T2.TGT,2),'FM999999999999990.99'),'.') TGT
		     , CASE WHEN T1.TOT <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.TOT/MENGE*1000000) ELSE 0 END TOT
		     , CASE WHEN T1.C01 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C01/MENGE01*1000000) ELSE 0 END C01
		     , CASE WHEN T1.C02 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C02/MENGE02*1000000) ELSE 0 END C02
		     , CASE WHEN T1.C03 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C03/MENGE03*1000000) ELSE 0 END C03
		     , CASE WHEN T1.C04 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C04/MENGE04*1000000) ELSE 0 END C04
		     , CASE WHEN T1.C05 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C05/MENGE05*1000000) ELSE 0 END C05
		     , CASE WHEN T1.C06 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C06/MENGE06*1000000) ELSE 0 END C06
		     , CASE WHEN T1.C07 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C07/MENGE07*1000000) ELSE 0 END C07
		     , CASE WHEN T1.C08 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C08/MENGE08*1000000) ELSE 0 END C08
		     , CASE WHEN T1.C09 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C09/MENGE09*1000000) ELSE 0 END C09
		     , CASE WHEN T1.C10 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C10/MENGE10*1000000) ELSE 0 END C10
		     , CASE WHEN T1.C11 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C11/MENGE11*1000000) ELSE 0 END C11
		     , CASE WHEN T1.C12 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C12/MENGE12*1000000) ELSE 0 END C12
		     , T1.CNT
		FROM (
		SELECT 
		<choose>
			<when test='TYPE != null and TYPE == "0000003575"'>
			   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END) ,0) AS TOT
			 , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END) ,0) AS C12
			</when>
			<otherwise>
			   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN B_QTY ELSE 0 END) ,0) AS TOT
			 , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN B_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN B_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN B_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN B_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN B_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN B_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN B_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN B_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN B_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN B_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN B_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN B_QTY ELSE 0 END) ,0) AS C12
			</otherwise>
		</choose>
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN 1 ELSE 0 END),0) CNT   
		  FROM Q_100 a
		 WHERE A.COMPANYCD = #{COMPANYCD} 
		<choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
					</otherwise>
				</choose>
			</when>
		</choose> 
		<choose>
			<when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131')
			</when>
			<when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			</when>
			<when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			</when>
		</choose>
		   AND PROTYPE IN ('0000003450','0000003451','0000003452','0000003453','0000003454')
		) T1, 
		(SELECT NVL(AVG(R.TGT),0) TGT FROM (
			SELECT PLANTCD, NVL((SUM(G01) + SUM(G02) + SUM(G03) + SUM(G04) + SUM(G05) + SUM(G06) + SUM(G07) + SUM(G08) + SUM(G09) + SUM(G10) + SUM(G11) + SUM(G12))/12, 0) AS TGT 
			  from q_050 A
			 WHERE COMPANYCD = #{COMPANYCD} AND YY = #{YYYY} AND B_GBN = #{TYPE} AND B_DTL = '0000003582'
			 <choose>
				<when test='HQ != null and HQ == "C"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
						</otherwise>
					</choose>
				</when>
				<when test='HQ != null and HQ == "F"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
						</otherwise>
					</choose>
				</when>
				<when test='HQ != null and HQ == "P"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
						</otherwise>
					</choose>
				</when>
			</choose>
			GROUP BY PLANTCD ) R
		) T2,
		(SELECT SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS MENGE
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS MENGE01
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS MENGE02
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS MENGE03
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS MENGE04
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS MENGE05
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS MENGE06
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS MENGE07
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS MENGE08
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS MENGE09
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS MENGE10
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS MENGE11
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS MENGE12
		   FROM ERP_BASIC A
		  WHERE 1=1
		  <choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
					</otherwise>
				</choose>
			</when>
		  </choose>
		  <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		    AND GUBUN = 'SD'
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		    AND GUBUN = 'PP' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		    AND GUBUN = 'MM' 
			 </when>
		  </choose>
		)T3
		UNION ALL
		<!-- 페달 -->
		SELECT '페달' TITLE2 , RTRIM(TO_CHAR(ROUND(T2.TGT,2),'FM999999999999990.99'),'.') TGT
		     , CASE WHEN T1.TOT <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.TOT/MENGE*1000000) ELSE 0 END TOT
		     , CASE WHEN T1.C01 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C01/MENGE01*1000000) ELSE 0 END C01
		     , CASE WHEN T1.C02 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C02/MENGE02*1000000) ELSE 0 END C02
		     , CASE WHEN T1.C03 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C03/MENGE03*1000000) ELSE 0 END C03
		     , CASE WHEN T1.C04 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C04/MENGE04*1000000) ELSE 0 END C04
		     , CASE WHEN T1.C05 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C05/MENGE05*1000000) ELSE 0 END C05
		     , CASE WHEN T1.C06 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C06/MENGE06*1000000) ELSE 0 END C06
		     , CASE WHEN T1.C07 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C07/MENGE07*1000000) ELSE 0 END C07
		     , CASE WHEN T1.C08 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C08/MENGE08*1000000) ELSE 0 END C08
		     , CASE WHEN T1.C09 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C09/MENGE09*1000000) ELSE 0 END C09
		     , CASE WHEN T1.C10 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C10/MENGE10*1000000) ELSE 0 END C10
		     , CASE WHEN T1.C11 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C11/MENGE11*1000000) ELSE 0 END C11
		     , CASE WHEN T1.C12 <![CDATA[>]]> 0 AND MENGE <![CDATA[>]]> 0 THEN ROUND(T1.C12/MENGE12*1000000) ELSE 0 END C12
		     , T1.CNT
		FROM (
		SELECT 
		<choose>
			<when test='TYPE != null and TYPE == "0000003575"'>
			   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END) ,0) AS TOT
			 , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END) ,0) AS C12
			</when>
			<otherwise>
			   NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN B_QTY ELSE 0 END) ,0) AS TOT
			 , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN B_QTY ELSE 0 END) ,0) AS C01
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN B_QTY ELSE 0 END) ,0) AS C02
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN B_QTY ELSE 0 END) ,0) AS C03
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN B_QTY ELSE 0 END) ,0) AS C04
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN B_QTY ELSE 0 END) ,0) AS C05
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN B_QTY ELSE 0 END) ,0) AS C06
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN B_QTY ELSE 0 END) ,0) AS C07
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN B_QTY ELSE 0 END) ,0) AS C08
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN B_QTY ELSE 0 END) ,0) AS C09
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN B_QTY ELSE 0 END) ,0) AS C10
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN B_QTY ELSE 0 END) ,0) AS C11
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN B_QTY ELSE 0 END) ,0) AS C12
			</otherwise>
		</choose>
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN 1 ELSE 0 END),0) CNT   
		  FROM Q_100 a
		 WHERE A.COMPANYCD = #{COMPANYCD} 
		<choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
					</otherwise>
				</choose>
			</when>
		</choose>  
		<choose>
			<when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131')
			</when>
			<when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			</when>
			<when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			</when>
		</choose>
		   AND PROTYPE = '0000003455'
		) T1, 
		(SELECT NVL(AVG(R.TGT),0) TGT FROM (
			SELECT PLANTCD, NVL((SUM(G01) + SUM(G02) + SUM(G03) + SUM(G04) + SUM(G05) + SUM(G06) + SUM(G07) + SUM(G08) + SUM(G09) + SUM(G10) + SUM(G11) + SUM(G12))/12, 0) AS TGT 
			  from q_050 A
			 WHERE COMPANYCD = #{COMPANYCD} AND YY = #{YYYY} AND B_GBN = #{TYPE} AND B_DTL = '0000003583'
			 <choose>
				<when test='HQ != null and HQ == "C"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
						</otherwise>
					</choose>
				</when>
				<when test='HQ != null and HQ == "F"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
						</otherwise>
					</choose>
				</when>
				<when test='HQ != null and HQ == "P"'>
					<choose>
						<when test="PLANT != null and PLANT != ''">
							AND A.PLANTCD = #{PLANT}
						</when>
						<otherwise>
							AND A.PLANTCD IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
						</otherwise>
					</choose>
				</when>
			</choose>
			GROUP BY PLANTCD ) R
		) T2,
		(SELECT SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS MENGE
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END) AS MENGE01
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END) AS MENGE02
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END) AS MENGE03
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END) AS MENGE04
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END) AS MENGE05
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END) AS MENGE06
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END) AS MENGE07
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END) AS MENGE08
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END) AS MENGE09
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END) AS MENGE10
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END) AS MENGE11
			  , SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END) AS MENGE12
		   FROM ERP_BASIC A
		  WHERE 1=1
		  <choose>
			<when test='HQ != null and HQ == "C"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'C')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "F"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'F')
					</otherwise>
				</choose>
			</when>
			<when test='HQ != null and HQ == "P"'>
				<choose>
					<when test="PLANT != null and PLANT != ''">
						AND A.PLANT = #{PLANT}
					</when>
					<otherwise>
						AND A.PLANT IN (SELECT PLANT_CD FROM COM_PLANT_INFO WHERE MGT1 = 'P')
					</otherwise>
				</choose>
			</when>
		  </choose>
		  <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		    AND GUBUN = 'SD'
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		    AND GUBUN = 'PP' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		    AND GUBUN = 'MM' 
			 </when>
		  </choose>
		)T3
	</select>
	<!-- 불량률추이(고객,공정,외주) 년도별 실적 조회 -->
	<select id="selectYearPerformanceRate" parameterType="json" resultType="string">
	
	</select>
	
	<!-- 불량현황(고객,공정,외주) > 그리드 조회 -->
	<select id="selectStatusFaultyList" parameterType="json" resultType="json">
		SELECT NVL(SUM(CASE WHEN SPMON LIKE TO_NUMBER(#{YYYY})-1||'%' THEN MENGE ELSE 0 END),0) AS PREV_YEAR
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'%'   THEN MENGE ELSE 0 END),0) AS TOT
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'01%' THEN MENGE ELSE 0 END),0) AS JAN
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'02%' THEN MENGE ELSE 0 END),0) AS FEB
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'03%' THEN MENGE ELSE 0 END),0) AS MAR 
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'04%' THEN MENGE ELSE 0 END),0) AS APR
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'05%' THEN MENGE ELSE 0 END),0) AS MAY
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'06%' THEN MENGE ELSE 0 END),0) AS JUN
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'07%' THEN MENGE ELSE 0 END),0) AS JUL
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'08%' THEN MENGE ELSE 0 END),0) AS AUG
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'09%' THEN MENGE ELSE 0 END),0) AS SEP
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'10%' THEN MENGE ELSE 0 END),0) AS OCT
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'11%' THEN MENGE ELSE 0 END),0) AS NOV
		     , NVL(SUM(CASE WHEN SPMON LIKE #{YYYY}||'12%' THEN MENGE ELSE 0 END),0) AS DEC
		FROM ERP_BASIC
		WHERE PLANT = #{PLANT}
		<choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		  AND GUBUN = 'SD'
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		  AND GUBUN = 'PP' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		  AND GUBUN = 'MM' 
			 </when>
		</choose>
		UNION ALL
		SELECT NVL(SUM(CASE WHEN B_YMD LIKE TO_NUMBER(#{YYYY})-1||'%' THEN K_QTY ELSE 0 END),0) AS PREV_YEAR
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%'   THEN K_QTY ELSE 0 END),0) AS TOT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN K_QTY ELSE 0 END),0) AS JAN
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN K_QTY ELSE 0 END),0) AS FEB
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN K_QTY ELSE 0 END),0) AS MAR 
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN K_QTY ELSE 0 END),0) AS APR
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN K_QTY ELSE 0 END),0) AS MAY
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN K_QTY ELSE 0 END),0) AS JUN
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN K_QTY ELSE 0 END),0) AS JUL
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN K_QTY ELSE 0 END),0) AS AUG
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN K_QTY ELSE 0 END),0) AS SEP
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN K_QTY ELSE 0 END),0) AS OCT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN K_QTY ELSE 0 END),0) AS NOV
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN K_QTY ELSE 0 END),0) AS DEC
		  FROM Q_100
		 WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT}
		 <if test="PROTYPE != null and PROTYPE != ''">
		   AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
		 </if>
		 <if test="PARTNO != null and PARTNO !=''">
		   AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
		 </if>
		 <if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
		   AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
		 </if>
		 <if test="TYPE_GBN != null and TYPE_GBN != ''">
		   AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
		 </if>
		 <if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
		   AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
		 </if>
		 <if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
		   AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
		 </if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	
		   AND GUBUN <![CDATA[<>]]> '0000002209' 
			 </when>
		 </choose>
		UNION ALL
		SELECT NVL(SUM(CASE WHEN B_YMD LIKE TO_NUMBER(#{YYYY})-1||'%' THEN 1 ELSE 0 END),0) AS PREV_YEAR
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%'   THEN 1 ELSE 0 END),0) AS TOT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN 1 ELSE 0 END),0) AS JAN
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN 1 ELSE 0 END),0) AS FEB
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN 1 ELSE 0 END),0) AS MAR 
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN 1 ELSE 0 END),0) AS APR
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN 1 ELSE 0 END),0) AS MAY
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN 1 ELSE 0 END),0) AS JUN
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN 1 ELSE 0 END),0) AS JUL
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN 1 ELSE 0 END),0) AS AUG
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN 1 ELSE 0 END),0) AS SEP
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN 1 ELSE 0 END),0) AS OCT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN 1 ELSE 0 END),0) AS NOV
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN 1 ELSE 0 END),0) AS DEC
		  FROM Q_100
		 WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT}
		 <if test="PROTYPE != null and PROTYPE != ''">
		   AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
		 </if>
		 <if test="PARTNO != null and PARTNO !=''">
		   AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
		 </if>
		 <if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
		   AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
		 </if>
		 <if test="TYPE_GBN != null and TYPE_GBN != ''">
		   AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
		 </if>
		 <if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
		   AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
		 </if>
		 <if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
		   AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
		 </if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			 </when>
		 </choose>
		UNION ALL
		SELECT NVL(SUM(CASE WHEN B_YMD LIKE TO_NUMBER(#{YYYY})-1||'%' THEN BAL_QTY ELSE 0 END),0) AS PREV_YEAR
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END),0) AS TOT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN BAL_QTY ELSE 0 END),0) AS JAN
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN BAL_QTY ELSE 0 END),0) AS FEB
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN BAL_QTY ELSE 0 END),0) AS MAR 
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN BAL_QTY ELSE 0 END),0) AS APR
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN BAL_QTY ELSE 0 END),0) AS MAY
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN BAL_QTY ELSE 0 END),0) AS JUN
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN BAL_QTY ELSE 0 END),0) AS JUL
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN BAL_QTY ELSE 0 END),0) AS AUG
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN BAL_QTY ELSE 0 END),0) AS SEP
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN BAL_QTY ELSE 0 END),0) AS OCT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN BAL_QTY ELSE 0 END),0) AS NOV
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN BAL_QTY ELSE 0 END),0) AS DEC
		  FROM Q_100
		 WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT}
		 <if test="PROTYPE != null and PROTYPE != ''">
		   AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
		 </if>
		 <if test="PARTNO != null and PARTNO !=''">
		   AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
		 </if>
		 <if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
		   AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
		 </if>
		 <if test="TYPE_GBN != null and TYPE_GBN != ''">
		   AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
		 </if>
		 <if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
		   AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
		 </if>
		 <if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
		   AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
		 </if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			 </when>
		 </choose>
		UNION ALL
		SELECT NVL(SUM(CASE WHEN YY = TO_NUMBER(#{YYYY})-1 THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END)/12,0) AS PREV_YEAR
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G01+G02+G03+G04+G05+G06+G07+G08+G09+G10+G11+G12 ELSE 0 END)/12,0) AS TOT
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G01 ELSE 0 END),0) AS JAN
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G02 ELSE 0 END),0) AS FEB
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G03 ELSE 0 END),0) AS MAR
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G04 ELSE 0 END),0) AS APR
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G05 ELSE 0 END),0) AS MAY
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G06 ELSE 0 END),0) AS JUN
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G07 ELSE 0 END),0) AS JUL
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G08 ELSE 0 END),0) AS AUG
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G09 ELSE 0 END),0) AS SEP
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G10 ELSE 0 END),0) AS OCT
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G11 ELSE 0 END),0) AS NOV
		     , NVL(SUM(CASE WHEN YY = #{YYYY} THEN G12 ELSE 0 END),0) AS DEC
		  FROM Q_050 
		 WHERE COMPANYCD = #{COMPANYCD} AND PLANTCD = #{PLANT}
		   AND B_GBN = #{TYPE}
		UNION ALL
		SELECT NVL(SUM(CASE WHEN B_YMD LIKE TO_NUMBER(#{YYYY})-1||'%' THEN B_QTY ELSE 0 END),0) AS PREV_YEAR
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%'   THEN B_QTY ELSE 0 END),0) AS TOT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'01%' THEN B_QTY ELSE 0 END),0) AS JAN
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'02%' THEN B_QTY ELSE 0 END),0) AS FEB
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'03%' THEN B_QTY ELSE 0 END),0) AS MAR 
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'04%' THEN B_QTY ELSE 0 END),0) AS APR
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'05%' THEN B_QTY ELSE 0 END),0) AS MAY
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'06%' THEN B_QTY ELSE 0 END),0) AS JUN
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'07%' THEN B_QTY ELSE 0 END),0) AS JUL
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'08%' THEN B_QTY ELSE 0 END),0) AS AUG
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'09%' THEN B_QTY ELSE 0 END),0) AS SEP
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'10%' THEN B_QTY ELSE 0 END),0) AS OCT
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'11%' THEN B_QTY ELSE 0 END),0) AS NOV
		     , NVL(SUM(CASE WHEN B_YMD LIKE #{YYYY}||'12%' THEN B_QTY ELSE 0 END),0) AS DEC
		  FROM Q_100
		 WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT}
		 <if test="PROTYPE != null and PROTYPE != ''">
		   AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
		 </if>
		 <if test="PARTNO != null and PARTNO !=''">
		   AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
		 </if>
		 <if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
		   AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
		 </if>
		 <if test="TYPE_GBN != null and TYPE_GBN != ''">
		   AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
		 </if>
		 <if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
		   AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
		 </if>
		 <if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
		   AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
		 </if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			 </when>
		 </choose>
	</select>
	<!-- 불량현황(고객,공정,외주) > 년도별 실적 조회 -->
	<select id="selectYearPerformanceStatus" parameterType="json" resultType="string">
		SELECT 
		<choose>
			<when test='TYPE != null and TYPE == "0000003575"'>
				CASE WHEN BAL_QTY > 0 AND MENGE > 0 THEN  TO_CHAR(ROUND(BAL_QTY/MENGE*1000000,2), 'FM999999999999990.99') ELSE '0' END
			</when>
			<otherwise>
				CASE WHEN B_QTY > 0 AND MENGE > 0 THEN  TO_CHAR(ROUND(B_QTY/MENGE*1000000,2), 'FM999999999999990.99') ELSE '0' END
			</otherwise>
		</choose>
		  FROM 
		  (SELECT SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN B_QTY ELSE 0 END) AS B_QTY
		  		, SUM(CASE WHEN B_YMD LIKE #{YYYY}||'%' THEN BAL_QTY ELSE 0 END) AS BAL_QTY
		     FROM Q_100
		    WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT}
		   	<if test="PROTYPE != null and PROTYPE != ''">
			  AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
			</if>
			<if test="PARTNO != null and PARTNO !=''">
			  AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
			</if>
			<if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
			  AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
			</if>
			<if test="TYPE_GBN != null and TYPE_GBN != ''">
			  AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
			</if>
			<if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
			  AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
			</if>
			<if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
			  AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
			</if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			 </when>
		 </choose>
		)T1 
		, (SELECT SUM(CASE WHEN SPMON LIKE #{YYYY}||'%' THEN MENGE ELSE 0 END) AS MENGE
			 FROM ERP_BASIC
			WHERE PLANT = #{PLANT}
			<choose>
				 <when test='TYPE != null and TYPE == "0000003573"'>
			  AND GUBUN = 'SD'
				 </when>
				 <when test='TYPE != null and TYPE == "0000003574"'>
			  AND GUBUN = 'PP' 
				 </when>
				 <when test='TYPE != null and TYPE == "0000003575"'>
			  AND GUBUN = 'MM' 
				 </when>
			</choose>
		)T2
	</select>
	<!-- 불량현황(고객,공정,외주) > 발생처별 데이터 조회 -->
	<select id="selectBplaceData" parameterType="json" resultType="json">
		SELECT B_PLACE_NAME "name", COUNT(*) "y"
		  FROM Q_100
		 WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT} AND B_YMD LIKE #{YYYY}||'%'
	   	 <if test="PROTYPE != null and PROTYPE != ''">
		   AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
		 </if>
		 <if test="PARTNO != null and PARTNO !=''">
		   AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
		 </if>
		 <if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
		   AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
		 </if>
		 <if test="TYPE_GBN != null and TYPE_GBN != ''">
		   AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
		 </if>
		 <if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
		   AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
		 </if>
		 <if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
		   AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
		 </if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			 </when>
		 </choose>
		 GROUP BY B_PLACE_NAME
	</select>
	<!-- 불량현황(고객,공정,외주) > 품목별 데이터 조회 -->
	<select id="selectProtypeData" parameterType="json" resultType="json">
		SELECT PREMIER_SYS.GET_ITGR_CODE_NAME(T.PROTYPE, #{LANG}) "name", T.CNT "y" FROM (
		SELECT PROTYPE, COUNT(*) CNT 
		  FROM Q_100
		WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT} AND B_YMD LIKE #{YYYY}||'%'
	   	 <if test="PROTYPE != null and PROTYPE != ''">
		   AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
		 </if>
		 <if test="PARTNO != null and PARTNO !=''">
		   AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
		 </if>
		 <if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
		   AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
		 </if>
		 <if test="TYPE_GBN != null and TYPE_GBN != ''">
		   AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
		 </if>
		 <if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
		   AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
		 </if>
		 <if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
		   AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
		 </if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
	   	  AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
	   	  AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
	   	  AND B_GBN = '0000002548'	 
	   	  AND GUBUN <![CDATA[<>]]> '0000002209'
			 </when>
		 </choose>
		GROUP BY PROTYPE ) T
	</select>
	<!-- 불량현황(고객,공정,외주) > 현상별 데이터 조회 -->
	<select id="selectTypegbnData" parameterType="json" resultType="json">
		SELECT PREMIER_SYS.GET_ITGR_CODE_NAME(T.TYPE_GBN, #{LANG}) "name", T.CNT "y" FROM (
		SELECT TYPE_GBN, COUNT(*) CNT
		  FROM Q_100
		WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT} AND B_YMD LIKE #{YYYY}||'%'
	     <if test="PROTYPE != null and PROTYPE != ''">
		   AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
		 </if>
		 <if test="PARTNO != null and PARTNO !=''">
		   AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
		 </if>
		 <if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
		   AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
		 </if>
		 <if test="TYPE_GBN != null and TYPE_GBN != ''">
		   AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
		 </if>
		 <if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
		   AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
		 </if>
		 <if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
		   AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
		 </if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			 </when>
		 </choose>
		 GROUP BY TYPE_GBN ) T
	</select>
	<!-- 불량현황(고객,공정,외주) > 차종별 데이터 조회 -->
	<select id="selectKindcdData" parameterType="json" resultType="json">
		SELECT KINDCD "name", COUNT(*) "y"
		  FROM Q_100
		 WHERE COMPANYCD 	= #{COMPANYCD} AND PLANT = #{PLANT} AND B_YMD LIKE #{YYYY}||'%'
	   	 <if test="PROTYPE != null and PROTYPE != ''">
		   AND PROTYPE 		LIKE '%'||#{PROTYPE}||'%'
		 </if>
		 <if test="PARTNO != null and PARTNO !=''">
		   AND PARTNO 		LIKE '%'||#{PARTNO}||'%'
		 </if>
		 <if test="TYPE_GBN_U != null and TYPE_GBN_U != ''">
		   AND TYPE_GBN_U 	LIKE '%'||#{TYPE_GBN_U}||'%'
		 </if>
		 <if test="TYPE_GBN != null and TYPE_GBN != ''">
		   AND TYPE_GBN 	LIKE '%'||#{TYPE_GBN}||'%'
		 </if>
		 <if test="TYPE_CAUSE != null and TYPE_CAUSE != ''">
		   AND TYPE_CAUSE   LIKE '%'||#{TYPE_CAUSE}||'%'
		 </if>
		 <if test="B_PLACE_NAME != null and B_PLACE_NAME != ''">
		   AND B_PLACE_NAME LIKE '%'||#{B_PLACE_NAME}||'%'
		 </if>
		 <choose>
			 <when test='TYPE != null and TYPE == "0000003573"'>
		   AND B_GBN IN ('0000002128','0000002131') 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003574"'>
		   AND B_GBN = '0000002129' 
			 </when>
			 <when test='TYPE != null and TYPE == "0000003575"'>
		   AND B_GBN = '0000002548'	 
		   AND GUBUN <![CDATA[<>]]> '0000002209'
			 </when>
		 </choose>
		 GROUP BY KINDCD
	</select>
	<!-- 공장별 본부조회 -->
	<select id="selectPlantHQ" parameterType="json" resultType="string">
		SELECT MGT1 FROM COM_PLANT_INFO WHERE CMPY_SN = #{CMPY_SN} AND PLANT_CD = #{PLANT}
	</select>
</mapper>
