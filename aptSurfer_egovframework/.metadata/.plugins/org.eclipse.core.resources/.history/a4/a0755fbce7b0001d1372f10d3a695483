<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dbvalley.premier.scm1.createUpDelN.mapper.CreateUpDelNMapper">

<select id="selectCreateUpDelNListL" parameterType="json"
		resultType="json">

	SELECT SUBSTR(SEQNO,1,10) AS VBELN
	FROM TSCM_INB_DELIV_DISP_HISTORY A
	WHERE WERKS = #{WERKS}
	AND LIFNR = #{LIFNR}
	AND LOGIN_YMD BETWEEN TO_DATE(#{LFDAT_LA}||'000000','YYYYMMDDHH24MISS')
	AND	TO_DATE(#{LFDAT_LA_TO}||'235959','YYYYMMDDHH24MISS')
	AND MATNR = NVL(#{MATNR},MATNR)
	AND NOT EXISTS (SELECT 1 FROM TSCM_INB_PUR_SPEC
	WHERE SCM_VBELN = SUBSTR(A.SEQNO,1,10)
	AND MATNR = A.MATNR
	AND NVL(CHARG,'Z') = NVL(A.CHARG,NVL(CHARG,'Z')))
	AND DELYN = 'Y'
	GROUP BY SUBSTR(SEQNO,1,10)
	ORDER BY SUBSTR(SEQNO,1,10)
		
	</select>
	
	<select id="selectCreateUpDelNListR" parameterType="json"
		resultType="json">

	SELECT A.*
	, TO_CHAR(DEL_DATE ,'YYYY.MM.DD HH24:MI:SS') AS REAL_DELDATE
	, TO_CHAR(TO_DATE(LFDAT_LA, 'YYYYMMDD') ,'YYYY.MM.DD') AS LFDAT_LA_1
	,PREMIER_SYS.GET_ITGR_MGT_CODE_NAME(#{CODE_SEQ_UP_LGORT}, A.LGORT,'',#{SYSLANG}) AS LGORTNM
	,PREMIER_SYS.GET_ITGR_MGT_CODE_NAME(#{CODE_SEQ_UP_WERKS}, A.WERKS,'',#{SYSLANG}) AS WERKSNM
	FROM TSCM_INB_DELIV_DISP_HISTORY A
	WHERE A.WERKS = #{WERKS}
	AND SUBSTR(A.SEQNO,1,10) = #{VBELN}
	AND A.LIFNR = #{LIFNR}
	AND A.MATNR = NVL(#{MATNR},A.MATNR)
	AND A.DELYN = 'Y'
	AND NOT EXISTS (SELECT 1 FROM TSCM_INB_PUR_SPEC
	WHERE SCM_VBELN = SUBSTR(A.SEQNO,1,10)
	AND MATNR = A.MATNR
	AND NVL(CHARG,'Z') = NVL(A.CHARG,NVL(CHARG,'Z')))
		
	</select>

	
</mapper>