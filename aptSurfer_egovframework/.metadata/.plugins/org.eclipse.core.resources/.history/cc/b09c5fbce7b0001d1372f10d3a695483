<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dbvalley.premier.scm1.dailyClose.mapper.DailyCloseMapper">
	<select id="dailyCloseList" parameterType="json" resultType="json">
		SELECT 	A.*, B.MAKTX, TO_CHAR(TO_DATE(A.BUDAT, 'yyyy-mm-dd'),'yyyy.mm.dd') BUDAT_1,
				TO_CHAR(E_SO_AMT, 'FM999,999,999,990') as E_SO_AMT_1,
				TO_CHAR(E_PO_AMT, 'FM999,999,999,990') as E_PO_AMT_1,
				TO_CHAR(E_AMT_SUM, 'FM999,999,999,990') as E_AMT_SUM_1
       	FROM  (
               SELECT *
                FROM (
                     	SELECT ROWNUM AS RNO, E_SO_AMT, E_PO_AMT, E_AMT_SUM, BUDAT, MATBF, CHARG, ERFME, STOCK_QTY, NETPR, DMBTR, WAERS, MBLNR, MJAHR, ZEILE, 0 AS SORTNO, ZGUBN
                        FROM TSCM_DAILY_CLOSE_LIST
                        WHERE SEQNO = #{SEQNO}

                        UNION ALL

                        SELECT *
                        FROM (
                                 SELECT NULL AS RNO, NULL AS E_SO_AMT, NULL AS E_PO_AMT, NULL AS E_AMT_SUM, BUDAT, NULL AS MATBF, NULL AS CHARG, NULL AS ERFME, NULL AS STOCK_QTY, 
                                       '일소계' AS NETPR, ''||SUM(DMBTR) AS DMBTR, NULL AS WAERS, NULL AS MBLNR, NULL AS MJAHR, NULL AS ZEILE, 1 AS SORTNO, NULL AS ZGUBN
                                FROM TSCM_DAILY_CLOSE_LIST
                                WHERE SEQNO = #{SEQNO}
                                GROUP BY ROLLUP(BUDAT)
                             )
                        WHERE BUDAT IS NOT NULL
                    ) ) A, TSCM_M_MATL_MST_IF B
        WHERE A.MATBF = B.MATNR(+)
            AND B.WERKS(+) = #{WERKS}
        ORDER BY A.BUDAT, A.SORTNO, A.RNO
    </select>    
</mapper>