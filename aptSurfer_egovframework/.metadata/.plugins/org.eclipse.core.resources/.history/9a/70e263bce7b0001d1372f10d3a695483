<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="com.dbvalley.premier.scm1.rgstBarco.mapper.RgstBarcoMapper">

	<!-- 수입검사 요청 목록 조회 -->
	<!-- insp_div	수검완료('Y')제외 하고 조회. -->
	<!-- 경창정공 자료 제외  20200922 oji -->
	<select id="selectRgstBarcoList" parameterType="json" resultType="json">
	
		SELECT A.*
		, ROWNUM RNO
		, TO_CHAR(A.ARRIVAL_TIME,'YYYY.MM.DD HH24:MI:SS') ARRIVAL_TIME24
		, RETURN_HTML_TEXT(PREMIER_SYS.GETNAMEBYACCNO(PREMIER_SYS.GETACCNOBYACCID(A.VENDCD)))||'['||A.VENDCD||']' AS VENDCDNM
		, PREMIER_SYS.GETCMPYNMBYCMPYSN(decode(A.PLANT,'1110','11','1210','13','1220','14','31')) PLANTNM   
		FROM(
		     SELECT  A.*
		     FROM    TSCM_ARRIVAL_LOT A 
		     WHERE   TO_CHAR(ARRIVAL_TIME,'YYYYMMDD') = REPLACE(#{DATE},'-','')
		     AND     ( INSP_DIV = 'N'
		              OR ( INSP_DIV = 'Y' AND ARRIVAL_TIME + 1/1440 <![CDATA[ > ]]>SYSDATE ))
		    ) A
		WHERE A.PLANT NOT LIKE '3%' 
		ORDER BY RNO, A.ARRIVAL_TIME DESC
	
	</select>

	<!-- 수입검사 요청 정보 조회 -->
	<!-- 경창은 같은거래명세서 품번에 항번이 다르게 나올 수 있기 때문.-->
	<select id="selectRgstBarcoInfo" parameterType="json" resultType="json">
		SELECT      LIFNR, LFDAT, WERKS
		FROM        TSCM_INB_PUR_SPEC 
		WHERE       VBELN = #{VBELN}
		AND         ROWNUM = 1 
		GROUP BY    LIFNR, LFDAT, WERKS
	</select>
	
	<!-- 수입검사 요청 정보  Y 체크 조회 -->
	<select id="selectYInfo" parameterType="json" resultType="json">
		SELECT 'Y' as IS_YN
		FROM(
		      SELECT    VBELN
		      FROM      TSCM_PO_LST_IF
		      WHERE     IFYN = 'Y'
		      AND       VBELN = LTRIM(#{VBELN},'0')
		      GROUP BY  VBELN
		)
	</select>
	
	<!-- 유무검사 혼재 여부 확인. -->
	<select id="selectGuidelineInfo" parameterType="json" resultType="json">
		SELECT  COUNT(*) CNT, MAX(GUIDELINE) GUIDELINE
		FROM(
		      SELECT  GUIDELINE
		      FROM    TSCM_INB_DELIV_DISP_HISTORY
		      WHERE   VBELN = #{VBELN}
		      GROUP BY GUIDELINE 
		)
	</select>
	
	<!-- 입하 삭제여부(모두 삭제 되었다면 수입검사의뢰를 할 필요가 없음 ) 20201218 -->
	<select id="selectCountInfo" parameterType="json" resultType="json">
		SELECT  COUNT(*) COUNT
		FROM    TSCM_INB_DELIV_DISP_HISTORY
		WHERE   VBELN = LTRIM(#{VBELN},'0')
		AND     DELYN = 'N'     
	</select>
	
	<!-- 저장 중복체크 -->
	<select id="selectCHK" parameterType="json" resultType="json">
		SELECT 'Y' CHK
		FROM TSCM_ARRIVAL_LOT
		WHERE LOTNO = #{VBELN}
	</select>

	<!-- 수입검사 요청 정보 삽입 -->
	<insert id="insertRgstBarcoInfo" parameterType="json">
		INSERT INTO TSCM_ARRIVAL_LOT 
			( VENDCD, LOTNO, ARRIVAL_TIME, INSP_DIV, PLANT )
		VALUES
			( #{LIFNR}, #{VBELN}, SYSDATE, #{IS_YN}, #{WERKS} )
	</insert>

	<!-- 수입검사 요청 정보 저장-->
	<update id="mergeRgstBarcoInfo" parameterType="json">


	</update>
	
	<!-- 수입검사 요청 정보 삭제 -->
	<delete id="deleteRgstBarcoInfo" parameterType="json">


	</delete>

</mapper>