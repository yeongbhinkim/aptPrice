<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dbvalley.premier.common.dev.mapper.DevMapper">
	<select id="selectDate" resultType="string">
		select sysdate as curdate from dual
	</select>

	<!-- 메뉴SEQ 조회 -->	
	<select id="getMenuSeq" parameterType="string" resultType="int">
		select a.menuseq as menuSeq
		from sys_menu a
		where a.menuurl = #{menuUrl}
	</select>
	
	<!-- 메뉴명 조회 -->
	<select id="getMenuName" parameterType="egovMap" resultType="string">
		select b.menuname
		from sys_menu a, sys_menulang b
		where a.menuseq = b.menuseq
		and a.menuurl = #{menuUrl}
		and b.lang = #{lang}
	</select>
	
	<resultMap id="resultLayoutFormMaster" type="HashMap">
		<result property="menuSeq" column="menuSeq" />
		<result property="menuName" column="menuName" />
		<result property="clobScript" column="clobScript" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>	
	
	<select id="selectLayoutFormMasterClobScript" parameterType="hashmap" resultMap="resultLayoutFormMaster">
		select   a.menuseq as menuSeq
		       , c.menuname as menuName
		<choose>
		  	<when test='htmlReplace == "Y"'>
		  	   , <![CDATA[a.clob_script as clobScript]]>
		  	</when>
		  	<otherwise>
			   , <![CDATA[CLOB_REPLACE(CLOB_REPLACE(a.clob_script, '<', '&lt;'), '>', '&gt;') as clobScript]]>
		  	</otherwise>
		</choose>
		from dev_layout_form_master a, sys_menu b, sys_menulang c
		where a.menuseq = b.menuseq
		and a.menuseq = c.menuseq
		and c.lang = 'KOR'
		and a.menuseq = #{menuSeq}
	</select>
	
	<select id="selectLayoutFormMaster" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.LayoutFormMasterVO">
		select a.menuseq as menuSeq
		     , c.menuname as menuName
		     , a.layout_seq as layoutSeq
		     , a.layout_search_max_height as layoutSearchMaxHeight
		     , a.layout_search_min_height as layoutSearchMinHeight
		     , a.layout_search_row_show as layoutSearchRowShow
		     , a.search_header_button_width as searchHeaderButtonWidth
<!-- 		     , <![CDATA[CLOB_REPLACE(CLOB_REPLACE(a.clob_script, '<', '&lt;'), '>', '&gt;') as clobScript]]> -->
		from dev_layout_form_master a, sys_menu b, sys_menulang c
		where a.menuseq = b.menuseq
		and a.menuseq = c.menuseq
		and c.lang = 'KOR'
<!-- 		and c.lang = nvl(#{lang}, 'KOR') -->
		and a.menuseq = #{menuSeq}
	</select>
	
	<select id="selectLayoutTemplateMaster" parameterType="int" resultType="com.dbvalley.premier.common.dev.vo.LayoutTemplateMasterVO">
		select a.layout_seq as layoutSeq
		     , a.layout_name as layoutName
		     , a.layout_desc as layoutDesc
		     , a.sortnum as sortNum
		     , a.cell_id_text as cellIdText
		     , a.layout_clob as layoutClob
		     , a.empty_reg_button_clob as emptyRegButtonClob
		from dev_layout_template_master a
		where a.layout_seq = #{layout_seq}
	</select>
	
	<select id="selectLayoutTemplateCellMaster" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.LayoutTemplateCellMasterVO">
		select a.menuseq as menuSeq
		     , a.layout_seq as layoutSeq
		     , a.grid_cell_id as id
		     , a.header_text as header
		     , a.collapsable
		     , a.width
		     , a.height
		     , a.gravity
		     , a.resizable
		     , a.css
		from dev_layout_template_cell_master a
		where a.menuseq = #{menuSeq}
		and a.layout_seq = #{layoutSeq}
		order by a.sortnum
	</select>
	
	<select id="selectListRegButtonMaster" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.ButtonMasterVO">
		select b.button_seq as buttonSeq
		     , b.button_name as buttonName
		     , b.id
		     , nvl((select message from sys_message where messagecode = b.id and lang = #{lang}), b.value) as value
		     , b.label_code as labelCode
		     , b.icon
		     , b.button_view as "view"
		     , b.button_size as "size"
		     , b.color
		     , b.full
		     , b.circle
		     , b.loading
		     , b.submit
		     , b.parent
		     , b.width
		     , b.height
		     , b.css
		     , b.cellcss as cellCss
		     , b.disabled
		     , b.label
		     , b.labelwidth as labelWidth
		     , b.hiddenlabel as hiddenLabel
		     , b.labelinline as labelInline
		     , b.name
		     , b.helpmessage as helpMessage
		     , b.premessage as preMessage
		     , b.successmessage as successMessage
		     , b.errormessage
		     , b.gravity
		     , b.sortnum
		from dev_list_reg_button_master a, dev_control_button_master b
		where a.button_seq = b.button_seq
		and a.menuseq = #{menuSeq}
		order by a.sortnum
	</select>
	
	<select id="selectGridMaster" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.GridMasterVO">
		select a.menuseq as menuSeq
		     , a.grid_code as gridCode
		     , a.grid_remark as gridRemark
		     , a.header_row_count as headerRowCount
		     , a.footer_row_count as footerRowCount
		     , a.header_row_height as headerRowHeight
		     , a.footer_row_height as footerRowHeight
		     , a.width
		     , a.height
		     , a.auto_Width as autoWidth 
		     , a.resizable
		     , a.selection
		     , a.columns_auto_width as columnsAutoWidth
		     , a.sortable as sortable
		     , a.split_at as splitAt
		     , a.row_height as rowHeight
		     , a.editable as editable
		     , a.auto_empty_row as autoEmptyRow
		     , a.drag_mode as dragMode
		     , a.drag_copy as dragCopy
		     , a.css
		     , a.row_css as rowCss
		     , a.controller
		from dev_grid_master a
		where a.menuseq = #{menuSeq}
		and a.grid_code = #{gridCode}
	</select>
	
	<select id="selectGridColumn" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.GridColumnVO">
		select a.menuseq
		     , a.grid_code as gridCode
		     , a.column_id as id
		     , a.width
		     , a.editor_type as editorType
		     , a.hidden
		     , a.resizable
		     , a.type
		     , a.date_format as dateFormat
		     , a.max_width as maxWidth
		     , a.min_width as minWidth
		     , a.mark
		     , a.template
		     , a.sortnum
		from dev_grid_column a
		where a.menuseq = #{menuSeq}
		and a.grid_code = #{gridCode}
		order by a.sortnum
	</select>
	
	<select id="selectGridHeader" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.GridHeaderVO">
		select a.menuseq as menuSeq
		     , a.grid_code as gridCode
		     , a.column_id as id
		     , a.type
		     , a.row_seq as rowSeq
		     , nvl(GETMESSAGE(a.messagecode, #{lang}), a.text) as text
		     , a.content
		     , a.colspan
		     , a.rowspan
		     , a.css
		     , a.mark
		from dev_grid_header a, dev_grid_column b
		where a.menuseq = b.menuseq
		and a.grid_code = b.grid_code
		and a.column_id = b.column_id
		and a.menuseq = #{menuSeq}
		and a.grid_Code = #{gridCode}
		and a.type = #{type}
		order by b.sortnum, a.row_seq
	</select>
	
	<select id="selectControlSearchMasterDefault" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.ControlSearchMasterVO">
		select a.menuseq
		     , a.control_seq as controlSeq
		     , a.control_type as controlType
		     , a.search_type as searchType
		     , a.row_no as rowNo
		     , a.col_no as colNo
		     , a.select_option as selectOption
		     , a.sortnum
		from dev_control_search_master a
		where a.menuseq = #{menuSeq}
		and a.search_type = 'default'
		order by a.sortnum
	</select>
	
	<select id="selectControlSearchMasterDetail" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.ControlSearchMasterVO">
		select a.menuseq
		     , a.control_seq as controlSeq
		     , a.control_type as controlType
		     , a.search_type as searchType
		     , a.row_no as rowNo
		     , a.col_no as colNo
		     , a.select_option as selectOption
		     , a.sortnum
		from dev_control_search_master a
		where a.menuseq = #{menuSeq}
		and a.search_type = 'detail'
		order by a.row_no, a.col_no
	</select>
	
	<select id="selectControlSearchMaster" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.ControlSearchMasterVO">
		select a.menuseq
		     , a.control_seq as controlSeq
		     , a.control_type as controlType
		     , a.search_type as searchType
		     , a.row_no as rowNo
		     , a.col_no as colNo
		     , a.select_option as selectOption
		     , a.sortnum
             , decode(a.control_type, 'input', b.id
                                    , 'select', c.id
                                    , 'datepicker', d.id) as ControlId 
        from dev_control_search_master a, dev_control_input_master b, dev_control_select_master c, dev_control_datepicker_master d
        where a.control_seq = b.control_seq(+)
          and a.control_seq = c.control_seq(+)
          and a.control_seq = d.control_seq(+)
		  and a.menuseq = #{menuSeq}
		order by a.search_type, a.row_no, a.col_no, a.sortnum
	</select>
	
	<select id="selectControlInputMaster" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.ControlInputMasterVO">
		select a.control_seq as controlSeq
		     , a.control_remark as controlRemark
		     , a.id
		     , 'input' as type
		     , a.validation
		     , a.value
		     , a.icon
		     , a.placeholder
		     , a.hidden
		     , a.autocomplete
		     , a.input_type
		     , a.parent
		     , a.width
		     , a.height
		     , a.css
		     , a.disabled
		     , nvl(GETMESSAGE(a.label_code, #{lang}), a.label) as label
		     , a.label_code as labelCode
		     , a.label_width as labelWidth
		     , a.hidden_label as hiddenLabel
		     , a.label_inline as labelInline
		     , a.name
		     , a.required
		     , a.help_message as helpMessage
		     , a.pre_message as preMessage
		     , a.success_message as successMessage
		     , a.error_message as errorMessage
		     , a.gravity
		from dev_control_input_master a
		where 1=1
		<if test="controlSeq != null and controlSeq != ''">
	      and control_seq = #{controlSeq}
	    </if>
		order by a.control_seq
	</select>
	
	<select id="selectControlSelectMaster" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.ControlSelectMasterVO">
        select a.control_seq as controlSeq
             , a.control_remark as controlRemark
             , a.code_seq_up as codeSeqUp
             , a.id
             , 'select' as type
             , a.value
             , a.icon
             , a.validation
             , a.parent
             , a.width
             , a.height
             , a.css
             , a.disabled
             , a.label_code as labelCode
             , nvl(GETMESSAGE(a.label_code, #{lang}), a.label) as label
             , a.label_width as labelWidth
             , a.hidden_label as hiddenLabel
             , a.label_inline as labelInline
             , a.name
             , a.help_message as helpMessage
             , a.pre_message as preMessage
             , a.success_message as successMessage
             , a.error_message as errorMessage
             , a.gravity
        from dev_control_select_master a
        where 1=1
		<if test="controlSeq != null and controlSeq != ''">
	      and control_seq = #{controlSeq}
	    </if>
		order by a.control_seq
	</select>
	
	<select id="selectControlDatepickerMaster" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.ControlDatepickerMasterVO">
		select a.control_seq as controlSeq
		     , a.control_remark as controlRemark
		     , a.id
		     , 'datepicker' as type
		     , case when a.default_date is null then a.value
		            when a.default_date = 'day' then to_char(sysdate+to_number(a.date_diff), nvl(a.default_date_format, 'yyyymmdd'))
		            when a.default_date = 'month' then to_char(ADD_MONTHS(sysdate, a.date_diff), nvl(a.default_date_format, 'yyyymmdd'))
		            when a.default_date = 'year' then to_char(add_months(sysdate, a.date_diff*12), nvl(a.default_date_format, 'yyyy'))
		            else a.value end value
		     , a.validation
		     , a.icon
		     , a.placeholder
		     , a.editable
		     , a.parent
		     , a.width
		     , a.height
		     , a.css
		     , a.disabled
		     , nvl(GETMESSAGE(a.label_code, #{lang}), a.label) as label
		     , a.label_code as labelCode
		     , a.label_width as labelWidth
		     , a.hidden_label as hiddenLabel
		     , a.label_inline as labelInline
		     , a.name
		     , a.required
		     , a.help_message as helpMessage
		     , a.pre_message as preMessage
		     , a.success_message as successMessage
		     , a.error_message as errorMessage
		     , a.gravity
		     , a.datepicker_mode as datepickerMode
		     , a.datepicker_date as datepickerDate
		     , a.mark
		     , a.disabled_dates as disabledDates
		     , a.week_start as weekStart
		     , a.week_numbers as weekNumbers
		     , a.time_picker as timePicker
		     , a.time_format as timeFormat
		     , a.date_format as dateFormat
		     , a.hide_other_month as hideOtherMonth
		     , a.date_mode as dateMode
		from dev_control_datepicker_master a
		where 1=1
		<if test="controlSeq != null and controlSeq != ''">
	      and control_seq = #{controlSeq}
	    </if>
		order by a.control_seq
	</select>
	
<select id="selectSelectBinding" parameterType="egovMap" resultType="com.dbvalley.premier.common.dev.vo.SelectBindingVO">
		select a.code_seq as value, b.code_name as content
		from sys_itgr_code_mgmt a, sys_itgr_code_lang b
		where a.code_seq = b.code_seq
		and a.code_seq_up = #{codeSeq}
		and a.code_seq_up not in ('0000000273')
		and a.active_flag = 'A'
		and b.code_seq_lang = #{lang}
		<if test="value != null and value != ''">
	      and a.code_seq = #{value}
	    </if>
		union all
		select a.cust_cd as value
		     , a.cust_nm as content
		from premier_plm.pms_cust_mst a
		where #{codeSeq} = '0000000273'
		<if test="value != null and value != ''">
	      and a.cust_cd = #{value}
	    </if>
	</select>
	
	<update id="updateLayoutFormMasterClobScript" parameterType="hashmap">
		update dev_layout_form_master
		set clob_script = #{clobScript:CLOB}
		where menuseq = #{menuSeq}
	</update>
	
	<update id="setDevControlSearchMaster" parameterType="hashmap">
		MERGE INTO dev_control_search_master A USING (
			SELECT to_number(#{menuSeq}) as menuSeq
				 , #{controlSeq} as controlSeq
				 , #{controlType} as controlType
				 , #{searchType} as searchType
				 , #{rowNo} as rowNo
				 , #{colNo} as colNo
				 , #{selectOption} as selectOption
				 , #{sortnum} as sortnum
			 FROM DUAL) D
		ON(A.menuseq = D.menuSeq and A.control_seq = D.controlSeq)
		WHEN MATCHED THEN
			UPDATE SET A.control_type = D.controlType
			         , A.search_type = D.searchType
			         , A.row_no = D.rowNo
			         , A.col_no = D.colNo
			         , A.select_option = D.selectOption
			         , A.sortnum = D.sortnum
		WHEN NOT MATCHED THEN
			INSERT (
				a.menuseq, a.control_seq, a.control_type, a.search_type, a.row_no, a.col_no, a.select_option, a.sortnum
	      	) VALUES (
	      		D.menuSeq, D.controlSeq, D.controlType, D.searchType, D.rowNo, D.colNo, D.selectOption, D.sortnum
	      	)
	</update>
	
	<delete id="deleteDevControlSearchMaster" parameterType="hashmap">
		DELETE dev_control_search_master
		WHERE menuseq = to_number(#{menuseq})
		  and control_seq = #{controlSeq}
	</delete>
	
</mapper>