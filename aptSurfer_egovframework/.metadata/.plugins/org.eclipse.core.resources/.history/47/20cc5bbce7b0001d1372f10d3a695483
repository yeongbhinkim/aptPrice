<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dbvalley.premier.qms.qualityindex.mapper.ClaimIndexMapper"> 
	<!-- 종합추이(워런티,캠페인) - 그리드 조회 -->
	<select id="selectFieldClaimAnalysisList" parameterType="json" resultType="json">
		SELECT A.*,
		       B.YY_A, B.GOAL_A, B.GOAL_B, B.YY_B, B.RATE_B, B.GOAL_C, B.MM_C, B.RATE_C
		FROM (
		      SELECT 10 CODE_ORDERNO, 'TOT' AS PK, '9999999999' AS CODE_SEQ, GETMESSAGE('label.sum',#{LANG}) AS CODE_NAME
		      FROM DUAL
		      UNION ALL
		      SELECT X.CODE_ORDERNO, X.MGT2 AS PK, Y.CODE_SEQ, Y.CODE_NAME
		      FROM SYS_ITGR_CODE_MGMT X, SYS_ITGR_CODE_LANG Y
		      WHERE X.CODE_SEQ = Y.CODE_SEQ
		      AND   X.ACTIVE_FLAG = 'A'
		      AND   X.CODE_SEQ_UP = '0000003576'
		      AND   X.MGT1 = '1'
		      AND   Y.CODE_SEQ_LANG = #{LANG}
		     ) A, (
		            SELECT NVL(RETURN_RATE_100(YY_B,GOAL_B),0) AS RATE_B,
		                   NVL(RETURN_RATE_100(MM_C,GOAL_C),0) AS RATE_C,
		                   S.*
		            FROM (
		                  SELECT 'TOT' AS PK,
		                         ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),TO_CHAR(TO_NUMBER(SUBSTR(#{YYYYMM},1,4))-1),Z.TOT_AMT,0))/100000000,2) AS YY_A,
		                         MIN((SELECT SUM(SCORE_YY) FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM = REPLACE(#{YYYYMM},'-',''))) AS GOAL_A,
		                         MIN((SELECT SUM(SCORE)/TO_NUMBER(SUBSTR(#{YYYYMM},6,2)) FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM <![CDATA[<=]]> REPLACE(#{YYYYMM},'-','') )) AS GOAL_B,
		                         ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),SUBSTR(#{YYYYMM},1,4),Z.TOT_AMT,0))/100000000,2) AS YY_B,
		                         MIN((SELECT SUM(SCORE) FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM = REPLACE(#{YYYYMM},'-','' ))) AS GOAL_C,
		                         ROUND(SUM(DECODE(Z.K_ISSUYYMM,REPLACE(#{YYYYMM},'-',''),Z.TOT_AMT,0))/100000000,2) AS MM_C
		                  FROM (
		                        SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                               NVL(X.DIV_AMT,0)+NVL(X.DH_AMT,0) AS TOT_AMT,
		                               Y.MGT1 AS PK, Y.MGT2, Y.PLANT_NM, X.*
		                        FROM Q_820_FIELD X, COM_PLANT_INFO Y
		                        WHERE X.COMPANYCD = Y.PLANT_CD
		                        AND   X.K_ISSUYYMM BETWEEN TO_CHAR(TO_NUMBER(SUBSTR(#{YYYYMM},1,4))-1)||'0101' AND SUBSTR(#{YYYYMM},1,4)||'1231'  
		                        <choose>									
									<when test="HQ != null and HQ != ''">
										AND   Y.MGT1 = #{HQ}
										<choose>
											<when test="PLANT != null and PLANT != ''"> 
										AND X.COMPANYCD = #{PLANT} 
											</when>
										</choose>
									</when>
								</choose>
		                       ) Z
		                  WHERE 1=1
		                  AND   Z.A_GUBUN = DECODE(#{TYPE},'T',Z.A_GUBUN,#{TYPE})
		                ) S
		            UNION ALL
		            SELECT NVL(RETURN_RATE_100(YY_B,GOAL_B),0) AS RATE_B,
		                   NVL(RETURN_RATE_100(MM_C,GOAL_C),0) AS RATE_C,
		                   S.*
		            FROM (
		                  SELECT Z.PK,
		                         ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),TO_CHAR(TO_NUMBER(SUBSTR(#{YYYYMM},1,4))-1),Z.TOT_AMT,0))/100000000,2) AS YY_A,
		                         (SELECT SCORE_YY FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM = REPLACE(#{YYYYMM},'-','') AND PLANT_GROUP = Z.PK ) AS GOAL_A,
		                         (SELECT SUM(SCORE)/TO_NUMBER(SUBSTR(#{YYYYMM},6,2)) FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM <![CDATA[<=]]> REPLACE(#{YYYYMM},'-','') AND PLANT_GROUP = Z.PK ) AS GOAL_B,
		                         ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),SUBSTR(#{YYYYMM},1,4),Z.TOT_AMT,0))/100000000,2) AS YY_B,
		                         (SELECT SCORE FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM = REPLACE(#{YYYYMM},'-','') AND PLANT_GROUP = Z.PK ) AS GOAL_C,
		                         ROUND(SUM(DECODE(Z.K_ISSUYYMM,REPLACE(#{YYYYMM},'-',''),Z.TOT_AMT,0))/100000000,2) AS MM_C
		                  FROM (
		                        SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                               NVL(X.DIV_AMT,0)+NVL(X.DH_AMT,0) AS TOT_AMT,
		                               Y.MGT1 AS PK, Y.MGT2, Y.PLANT_NM, X.*
		                        FROM Q_820_FIELD X, COM_PLANT_INFO Y
		                        WHERE X.COMPANYCD = Y.PLANT_CD
		                        AND   X.K_ISSUYYMM BETWEEN TO_CHAR(TO_NUMBER(SUBSTR(#{YYYYMM},1,4))-1)||'0101' AND SUBSTR(#{YYYYMM},1,4)||'1231'  
		                        <choose>									
									<when test="HQ != null and HQ != ''">
										AND   Y.MGT1 = #{HQ}
										<choose>
											<when test="PLANT != null and PLANT != ''"> 
										AND X.COMPANYCD = #{PLANT} 
											</when>
										</choose>
									</when>
								</choose>
		                       ) Z
		                  WHERE 1=1
		                  AND   Z.A_GUBUN = DECODE(#{TYPE},'T',Z.A_GUBUN,#{TYPE})
		                  GROUP BY Z.PK
		                ) S
		          ) B
		WHERE 1=1
		AND   A.PK = B.PK(+)
		ORDER BY A.CODE_ORDERNO
	</select>
	
	<!-- 종합추이(워런티,캠페인) PieChart 조회 -->
	<select id="selectFieldClaimAnalysisPieChart" parameterType="json" resultType="json">
		SELECT A.CODE_NAME AS "name", B.MM_C AS "y"
		FROM (
		      SELECT X.CODE_ORDERNO, X.MGT2 AS PK, Y.CODE_SEQ, Y.CODE_NAME
		      FROM SYS_ITGR_CODE_MGMT X, SYS_ITGR_CODE_LANG Y
		      WHERE X.CODE_SEQ = Y.CODE_SEQ
		      AND   X.ACTIVE_FLAG = 'A'
		      AND   X.CODE_SEQ_UP = '0000003576'
		      AND   X.MGT1 = '1'
		      AND   Y.CODE_SEQ_LANG = #{LANG}
		     ) A, (
		            SELECT NVL(RETURN_RATE_100(YY_B,GOAL_B),0) AS RATE_B,
		                   NVL(RETURN_RATE_100(MM_C,GOAL_C),0) AS RATE_C,
		                   S.*
		            FROM (
		                  SELECT Z.PK,
		                         ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),TO_CHAR(TO_NUMBER(SUBSTR(#{YYYYMM},1,4))-1),Z.TOT_AMT,0))/100000000,2) AS YY_A,
		                         (SELECT SCORE_YY FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM = REPLACE(#{YYYYMM},'-','') AND PLANT_GROUP = Z.PK ) AS GOAL_A,
		                         (SELECT SUM(SCORE)/TO_NUMBER(SUBSTR(#{YYYYMM},6,2)) FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM <![CDATA[<=]]> REPLACE(#{YYYYMM},'-','') AND PLANT_GROUP = Z.PK ) AS GOAL_B,
		                         ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),SUBSTR(#{YYYYMM},1,4),Z.TOT_AMT,0))/100000000,2) AS YY_B,
		                         (SELECT SCORE FROM V_Q_050 WHERE B_GBN = '0000003577' AND YYMM = REPLACE(#{YYYYMM},'-','') AND PLANT_GROUP = Z.PK ) AS GOAL_C,
		                         ROUND(SUM(DECODE(Z.K_ISSUYYMM,REPLACE(#{YYYYMM},'-',''),Z.TOT_AMT,0))/100000000,2) AS MM_C
		                  FROM (
		                        SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                               NVL(X.DIV_AMT,0)+NVL(X.DH_AMT,0) AS TOT_AMT,
		                               Y.MGT1 AS PK, Y.MGT2, Y.PLANT_NM, X.*
		                        FROM Q_820_FIELD X, COM_PLANT_INFO Y
		                        WHERE X.COMPANYCD = Y.PLANT_CD
		                        AND   X.K_ISSUYYMM BETWEEN TO_CHAR(TO_NUMBER(SUBSTR(#{YYYYMM},1,4))-1)||'0101' AND SUBSTR(#{YYYYMM},1,4)||'1231'  
		                       ) Z
		                  WHERE 1=1
		                  AND   Z.A_GUBUN = DECODE(#{TYPE},'T',Z.A_GUBUN,#{TYPE})
		                  GROUP BY Z.PK
		                ) S
		          ) B
		WHERE 1=1
		AND   A.PK = B.PK(+)
	</select>
	
	<!-- 종합추이(워런티,캠페인) - 년도별,월별  조회 -->
	<select id="selectFieldClaimAnalysisColumnChart" parameterType="json" resultType="json">
		SELECT A.*,
		       NVL(B.YY_A,0) AS YY_A, NVL(B.YY_B,0) AS YY_B, NVL(B.YY_C,0) AS YY_C,
		       NVL(B.M01,0) AS M01, NVL(B.M02,0) AS M02, NVL(B.M03,0) AS M03, NVL(B.M04,0) AS M04, NVL(B.M05,0) AS M05, NVL(B.M06,0) AS M06,
		       NVL(B.M07,0) AS M07, NVL(B.M08,0) AS M08, NVL(B.M09,0) AS M09, NVL(B.M10,0) AS M10, NVL(B.M11,0) AS M11, NVL(B.M12,0) AS M12
		FROM (
		      SELECT X.CODE_ORDERNO, X.MGT1 AS PK, Y.CODE_SEQ, Y.CODE_NAME
		      FROM SYS_ITGR_CODE_MGMT X, SYS_ITGR_CODE_LANG Y
		      WHERE X.CODE_SEQ = Y.CODE_SEQ
		      AND   X.ACTIVE_FLAG = 'A'
		      AND   X.CODE_SEQ_UP = '0000003587'
		      AND   X.MGT1 NOT IN ('T')
		      AND   Y.CODE_SEQ_LANG = #{LANG}
		     ) A, ( SELECT Z.A_GUBUN,
		                   ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),TO_CHAR(TO_NUMBER(#{YYYY})-2),Z.TOT_AMT,0))/100000000,2) AS YY_A,
		                   ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),TO_CHAR(TO_NUMBER(#{YYYY})-1),Z.TOT_AMT,0))/100000000,2) AS YY_B,
		                   ROUND(SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,1,4),#{YYYY},Z.TOT_AMT,0))/100000000,2) AS YY_C,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'01',Z.TOT_AMT,0))/100000000,2) AS M01,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'02',Z.TOT_AMT,0))/100000000,2) AS M02,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'03',Z.TOT_AMT,0))/100000000,2) AS M03,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'04',Z.TOT_AMT,0))/100000000,2) AS M04,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'05',Z.TOT_AMT,0))/100000000,2) AS M05,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'06',Z.TOT_AMT,0))/100000000,2) AS M06,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'07',Z.TOT_AMT,0))/100000000,2) AS M07,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'08',Z.TOT_AMT,0))/100000000,2) AS M08,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'09',Z.TOT_AMT,0))/100000000,2) AS M09,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'10',Z.TOT_AMT,0))/100000000,2) AS M10,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'11',Z.TOT_AMT,0))/100000000,2) AS M11,
		                   ROUND(SUM(DECODE(Z.K_ISSUYYMM,#{YYYY}||'12',Z.TOT_AMT,0))/100000000,2) AS M12
		            FROM (
		                  SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                         NVL(X.DIV_AMT,0)+NVL(X.DH_AMT,0) AS TOT_AMT,
		                         Y.MGT1 AS PK, Y.MGT2, Y.PLANT_NM, X.*
		                  FROM Q_820_FIELD X, COM_PLANT_INFO Y
		                  WHERE X.COMPANYCD = Y.PLANT_CD
		                  AND   X.K_ISSUYYMM BETWEEN TO_CHAR(TO_NUMBER(#{YYYY})-2)||'0101' AND #{YYYY}||'1231'  
		                  <choose>									
								<when test="HQ != null and HQ != ''">
									AND   Y.MGT1 = #{HQ}
									<choose>
										<when test="PLANT != null and PLANT != ''"> 
									AND X.COMPANYCD = #{PLANT} 
										</when>
									</choose>
								</when>
							</choose>
		                 ) Z
		            WHERE 1=1
		            GROUP BY Z.A_GUBUN
		          ) B
		WHERE 1=1
		AND   A.PK = B.A_GUBUN(+)
		<if test="A_GUBUN != null and A_GUBUN != ''">
		AND   A.PK = #{A_GUBUN}
		</if>
	</select>
	
	<!-- 귀책별 변제현황 - 그리드 조회 -->
	<select id="selectFieldClaimTypeList" parameterType="json" resultType="json">
		SELECT T.*
		FROM (
		      SELECT A.CODE_ORDERNO, A.CODE_SEQ, A.CODE_NAME,
		             NVL(B.W_AMT,0) AS W_AMT, NVL(B.C_AMT,0) AS C_AMT,
		             NVL(B.COMPANYCD_1100,0) AS COMPANYCD_1100, NVL(B.COMPANYCD_4100,0) AS COMPANYCD_4100, NVL(B.COMPANYCD_2100,0) AS COMPANYCD_2100,
		             NVL(B.COMPANYCD_4500,0) AS COMPANYCD_4500, NVL(B.COMPANYCD_3100,0) AS COMPANYCD_3100, NVL(B.TOTAL_AMT,0) AS TOTAL_AMT
		      FROM (
		            SELECT 1 CODE_ORDERNO, 'TOT' AS PK, '9999999999' AS CODE_SEQ, GETMESSAGE('label.sum',#{LANG}) AS CODE_NAME
		            FROM DUAL
		           ) A, ( SELECT '9999999999' AS CODE_SEQ,
		                         SUM(DECODE(Y.A_GUBUN,'W',TOTAL_AMT,0)) AS W_AMT,
		                         SUM(DECODE(Y.A_GUBUN,'C',TOTAL_AMT,0)) AS C_AMT,
		                         SUM(DECODE(Y.COMPANYCD,'1100',TOTAL_AMT,0)) AS COMPANYCD_1100,
		                         SUM(DECODE(Y.COMPANYCD,'4100',TOTAL_AMT,0)) AS COMPANYCD_4100,
		                         SUM(DECODE(Y.COMPANYCD,'2100',TOTAL_AMT,0)) AS COMPANYCD_2100,
		                         SUM(DECODE(Y.COMPANYCD,'4500',TOTAL_AMT,0)) AS COMPANYCD_4500,
		                         SUM(DECODE(Y.COMPANYCD,'3100',TOTAL_AMT,0)) AS COMPANYCD_3100,
		                         SUM(Y.TOTAL_AMT) AS TOTAL_AMT
		                  FROM (
		                        SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                               DECODE(X.FCDATAGBN,'0000003285',X.DIV_AMT,X.DH_AMT) AS TOTAL_AMT,
		                               X.*
		                        FROM Q_820_FIELD X
		                        WHERE X.COMPANYCD IN ('1100','4100','2100','4500','3100')
		                        AND   X.K_ISSUYYMM = REPLACE(#{YYYYMM},'-','')
		                        AND   X.FCDATAGBN IN ('0000003282','0000003285')
		                       ) Y
		                  WHERE 1=1
		                  AND   Y.A_GUBUN = DECODE(#{TYPE},'T',Y.A_GUBUN,#{TYPE})
		                ) B
		      WHERE 1=1
		      AND   A.CODE_SEQ = B.CODE_SEQ(+)
		      UNION ALL  
		      SELECT A.CODE_ORDERNO, A.CODE_SEQ, A.CODE_NAME,
		             NVL(B.W_AMT,0) AS W_AMT, NVL(B.C_AMT,0) AS C_AMT,
		             NVL(B.COMPANYCD_1100,0) AS COMPANYCD_1100, NVL(B.COMPANYCD_4100,0) AS COMPANYCD_4100, NVL(B.COMPANYCD_2100,0) AS COMPANYCD_2100,
		             NVL(B.COMPANYCD_4500,0) AS COMPANYCD_4500, NVL(B.COMPANYCD_3100,0) AS COMPANYCD_3100, NVL(B.TOTAL_AMT,0) AS TOTAL_AMT
		      FROM (
		            SELECT X.CODE_ORDERNO, Y.CODE_SEQ, Y.CODE_NAME
		            FROM SYS_ITGR_CODE_MGMT X, SYS_ITGR_CODE_LANG Y
		            WHERE X.CODE_SEQ = Y.CODE_SEQ
		            AND   X.ACTIVE_FLAG = 'A'
		            AND   X.CODE_SEQ_UP = '0000003281'
		            AND   X.CODE_SEQ IN ('0000003282','0000003285')
		            AND   Y.CODE_SEQ_LANG = #{LANG}
		           ) A, ( SELECT Y.FCDATAGBN AS CODE_SEQ,
		                         SUM(DECODE(Y.A_GUBUN,'W',TOTAL_AMT,0)) AS W_AMT,
		                         SUM(DECODE(Y.A_GUBUN,'C',TOTAL_AMT,0)) AS C_AMT,
		                         SUM(DECODE(Y.COMPANYCD,'1100',TOTAL_AMT,0)) AS COMPANYCD_1100,
		                         SUM(DECODE(Y.COMPANYCD,'4100',TOTAL_AMT,0)) AS COMPANYCD_4100,
		                         SUM(DECODE(Y.COMPANYCD,'2100',TOTAL_AMT,0)) AS COMPANYCD_2100,
		                         SUM(DECODE(Y.COMPANYCD,'4500',TOTAL_AMT,0)) AS COMPANYCD_4500,
		                         SUM(DECODE(Y.COMPANYCD,'3100',TOTAL_AMT,0)) AS COMPANYCD_3100,
		                         SUM(Y.TOTAL_AMT) AS TOTAL_AMT
		                  FROM (
		                        SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                               DECODE(X.FCDATAGBN,'0000003285',X.DIV_AMT,X.DH_AMT) AS TOTAL_AMT,
		                               X.*
		                        FROM Q_820_FIELD X
		                        WHERE X.COMPANYCD IN ('1100','4100','2100','4500','3100')
		                        AND   X.K_ISSUYYMM = REPLACE(#{YYYYMM},'-','')
		                        AND   X.FCDATAGBN IN ('0000003282','0000003285')
		                       ) Y
		                  WHERE 1=1
		                  AND   Y.A_GUBUN = DECODE(#{TYPE},'T',Y.A_GUBUN,#{TYPE})
		                  GROUP BY Y.FCDATAGBN
		                ) B
		      WHERE 1=1
		      AND   A.CODE_SEQ = B.CODE_SEQ(+)
		     ) T
		ORDER BY T.CODE_ORDERNO
	</select>
	
	<!-- 귀책별 변제현황 PieChart 조회 -->
	<select id="selectFieldClaimTypePieChart" parameterType="json" resultType="json">
		SELECT A.CODE_NAME AS "name", 
		       <choose>
		         <when test='YY_GUBUN != null and YY_GUBUN == "1"'>
		       B.TOT_CNT  AS "y"
		         </when>
		         <otherwise>
		       B.MON_CNT  AS "y"
		         </otherwise>
		       </choose>
		FROM (
		      SELECT X.CODE_ORDERNO, X.MGT2 AS PK, Y.CODE_SEQ, Y.CODE_NAME
		      FROM SYS_ITGR_CODE_MGMT X, SYS_ITGR_CODE_LANG Y
		      WHERE X.CODE_SEQ = Y.CODE_SEQ
		      AND   X.ACTIVE_FLAG = 'A'
		      AND   X.MGT1 = '1'
		      AND   X.CODE_SEQ_UP = '0000003576'
		      AND   X.CODE_SEQ NOT IN ('0000003583')
		      AND   Y.CODE_SEQ_LANG = #{LANG}
		     ) A, (
		            SELECT Z.PK,
		                   COUNT(*) AS TOT_CNT,
		                   SUM(DECODE(Z.K_ISSUYYMM,REPLACE(#{YYYYMM},'-',''),1,0)) AS MON_CNT
		            FROM (
		                  SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                         NVL(X.DIV_AMT,0)+NVL(X.DH_AMT,0) AS TOT_AMT,
		                         Y.MGT1 AS PK, Y.MGT2, Y.PLANT_NM, X.*
		                  FROM Q_820_FIELD X, COM_PLANT_INFO Y
		                  WHERE X.COMPANYCD = Y.PLANT_CD
		                  AND   X.COMPANYCD IN ('1100','4100','2100','4500','3100')
		                  AND   X.K_ISSUYYMM LIKE SUBSTR(#{YYYYMM},1,4)||'%'
		                  AND   X.FCDATAGBN IN ('0000003282','0000003285')
		               ) Z
		            WHERE 1=1
		            AND   Z.A_GUBUN = DECODE(#{TYPE},'T',Z.A_GUBUN,#{TYPE})
		            GROUP BY Z.PK
		          ) B
		WHERE 1=1
		AND   A.PK = B.PK(+)
	</select>
	
	<!-- 귀책별 변제현황 - 그리드 조회 -->
	<select id="selectFieldClaimTypeColumnChart" parameterType="json" resultType="json">
		SELECT A.*,
		       NVL(B.M01,0) AS M01, NVL(B.M02,0) AS M02, NVL(B.M03,0) AS M03, NVL(B.M04,0) AS M04, NVL(B.M05,0) AS M05, NVL(B.M06,0) AS M06,
		       NVL(B.M07,0) AS M07, NVL(B.M08,0) AS M08, NVL(B.M09,0) AS M09, NVL(B.M10,0) AS M10, NVL(B.M11,0) AS M11, NVL(B.M12,0) AS M12
		FROM (
		      SELECT 10 CODE_ORDERNO, 'T' AS PK, '9999999999' AS CODE_SEQ, GETMESSAGE('label.sum',#{LANG}) AS CODE_NAME
		      FROM DUAL
		      UNION ALL
		      SELECT X.CODE_ORDERNO, X.MGT2 AS PK, Y.CODE_SEQ, Y.CODE_NAME
		      FROM SYS_ITGR_CODE_MGMT X, SYS_ITGR_CODE_LANG Y
		      WHERE X.CODE_SEQ = Y.CODE_SEQ
		      AND   X.ACTIVE_FLAG = 'A'
		      AND   X.MGT1 = '1'
		      AND   X.CODE_SEQ_UP = '0000003576'
		      AND   X.CODE_SEQ NOT IN ('0000003583')
		      AND   Y.CODE_SEQ_LANG = #{LANG}
		     ) A, (
		            SELECT 'T' AS PK,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'01',TOT_AMT,0)) AS M01,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'02',TOT_AMT,0)) AS M02,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'03',TOT_AMT,0)) AS M03,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'04',TOT_AMT,0)) AS M04,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'05',TOT_AMT,0)) AS M05,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'06',TOT_AMT,0)) AS M06,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'07',TOT_AMT,0)) AS M07,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'08',TOT_AMT,0)) AS M08,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'09',TOT_AMT,0)) AS M09,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'10',TOT_AMT,0)) AS M10,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'11',TOT_AMT,0)) AS M11,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'12',TOT_AMT,0)) AS M12
		            FROM (
		                  SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                         NVL(X.DIV_AMT,0)+NVL(X.DH_AMT,0) AS TOT_AMT,
		                         Y.MGT1 AS PK, Y.MGT2, Y.PLANT_NM, X.*
		                  FROM Q_820_FIELD X, COM_PLANT_INFO Y
		                  WHERE X.COMPANYCD = Y.PLANT_CD
		                  AND   X.COMPANYCD IN ('1100','4100','2100','4500','3100')
		                  AND   X.K_ISSUYYMM LIKE SUBSTR(#{YYYYMM},1,4)||'%'
		                  AND   X.FCDATAGBN IN ('0000003282','0000003285')
		               ) Z
		            WHERE 1=1
		            AND   Z.A_GUBUN = DECODE(#{TYPE},'T',Z.A_GUBUN,#{TYPE})
		            UNION ALL
		            SELECT Z.PK,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'01',TOT_AMT,0)) AS M01,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'02',TOT_AMT,0)) AS M02,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'03',TOT_AMT,0)) AS M03,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'04',TOT_AMT,0)) AS M04,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'05',TOT_AMT,0)) AS M05,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'06',TOT_AMT,0)) AS M06,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'07',TOT_AMT,0)) AS M07,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'08',TOT_AMT,0)) AS M08,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'09',TOT_AMT,0)) AS M09,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'10',TOT_AMT,0)) AS M10,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'11',TOT_AMT,0)) AS M11,
		                   SUM(DECODE(SUBSTR(Z.K_ISSUYYMM,5,2),'12',TOT_AMT,0)) AS M12
		            FROM (
		                  SELECT DECODE(SUBSTR(X.NOTICE,-2,2),'CC','C','W') AS A_GUBUN, 
		                         NVL(X.DIV_AMT,0)+NVL(X.DH_AMT,0) AS TOT_AMT,
		                         Y.MGT1 AS PK, Y.MGT2, Y.PLANT_NM, X.*
		                  FROM Q_820_FIELD X, COM_PLANT_INFO Y
		                  WHERE X.COMPANYCD = Y.PLANT_CD
		                  AND   X.COMPANYCD IN ('1100','4100','2100','4500','3100')
		                  AND   X.K_ISSUYYMM LIKE SUBSTR(#{YYYYMM},1,4)||'%'
		                  AND   X.FCDATAGBN IN ('0000003282','0000003285')
		               ) Z
		            WHERE 1=1
		            AND   Z.A_GUBUN = DECODE(#{TYPE},'T',Z.A_GUBUN,#{TYPE})
		            GROUP BY Z.PK
		          ) B
		WHERE 1=1
		AND   A.PK = B.PK(+)
		<if test="A_GUBUN != null and A_GUBUN != ''">
	    AND   A.PK = #{A_GUBUN}
	    </if>
		ORDER BY A.CODE_ORDERNO
	</select>
	
</mapper>
